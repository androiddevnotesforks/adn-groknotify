const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gecewc5711hvt8ct.js","assets/bbqge6n6s1oo3m8q.js","assets/lt2ef0v2naysiy2l.js","assets/lemv4z8z7gk39eh5.js","assets/root-o5vuh9g4.css","assets/conversation-small-iybhw0ps.css","assets/mdwe0klwm30isq25.js","assets/j1ditdbor1tznbcv.js","assets/gcncyg0taymxf4pk.js","assets/o6uxxj59wwd0vs3h.js","assets/f23thkhb80aspj65.js","assets/qsqtyy3k2zvqht9q.js","assets/kj49w86db79ytvlv.js","assets/e9ioikt8tbassp1n.js","assets/b6besid35puipqnp.js","assets/dii6f0f58vjyxn3r.js","assets/pah0un9d5vytizt6.js","assets/k9i239fw3jmco37f.js","assets/bwqwq4vziwiutfyf.js","assets/havyc7t033iurbpd.js","assets/l7zuelk7pxni1h8r.js","assets/eqhwlxqfmealhi5i.js","assets/noizqcedq15ay25d.js","assets/frl423mmyu30ndvv.js","assets/csouf2u383m898mf.js","assets/c4bxzbp1808foto4.js","assets/o6rsu8ij68e2gpli.js","assets/hniv5ainu4kgopye.js","assets/e2ivuegnjko3c3gl.js","assets/jm0r787aq5qhv46g.js","assets/j0e9x6age48ds4le.js","assets/md3qrzfltjyzts14.js","assets/mmwacm2oz5glh3tg.js","assets/mn1nh5nafluqb0zf.js","assets/jbhsw5qghpjnsdph.js","assets/ilm9ui69tgxsiaqx.js","assets/jqq6n7loim0n1g6l.js","assets/i3n1htb1dnq2t6fv.js","assets/fs6pxtjro77wxbft.js","assets/fmjp8fe89brve9ez.js","assets/dhynomcx6cp3cbvl.js","assets/lvf1e4sndidq55l7.js","assets/l9v5qdgerk1gihp8.js","assets/dhc7pmihd9fsunt5.js","assets/nq4dv6tdmd8f93u7.js","assets/pcbzmtx4fgbka3lm.js","assets/f8js38hluf3qxo53.js","assets/euzs4rpetzyhiwmq.js","assets/mvdk1xvwj4qupms6.js","assets/d6quty219r41nxu4.js","assets/8orttzgjtniwaose.js","assets/lg9t9t7xcp2gqtpg.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/lg3hryf5udlg7sjl.js","assets/gvavze4qb7ke5olr.js","assets/iznswzwmsq1qveib.js"])))=>i.map(i=>d[i]);
import{ar as fe,cj as qe,P as K,j as X,bA as vo,aY as He,au as ss,bm as Pt,ap as P,am as zs,an as lt,hp as ia,cq as So,c as Xr,g as Jr,d3 as Ae,bC as gn,f as $e,aO as Oe,aP as Ue,dZ as pn,ak as dt,dg as Tt,r as J,h as Ne,bq as Qr,ad as Ve,a3 as kt,ba as ns,ew as os,bl as bo,g7 as Zr,g5 as ei,ez as ti,d8 as la,d$ as ze,hm as si,cb as ni,bT as Q,f6 as En,L as Gs,y as ca,aR as da,d6 as oi,ag as ut,em as ai,g3 as Rn,eJ as ri,W as yo,bo as Is,cn as ii,co as li,b3 as ci,gw as di,bp as Ds,hq as ui,bb as In,a2 as Nt,hr as mi,S as ue,cg as hi,D as fn,gc as ua,ae as ma,dX as ha,ff as gi,I as pi,a0 as wo,dO as Ws,fX as fi,hs as ga,aQ as Vs,fW as Pn,bj as Pe,ah as Dn,gC as Bn,u as qs,V as Ze,b4 as jo,bS as et,aj as _t,fF as xi,N as At,ee as Ln,B as Mt,$ as pa,e3 as vi,aT as Si,b7 as bi,d9 as fa,d5 as yi,f$ as wi,ht as Mo,K as Fn,O as cn,e9 as ji,hu as Mi,dd as Ci,d2 as _i,a1 as Ti,eB as ki,hv as Ni,fb as Ai,bE as Ei,dV as xn,e5 as Ri,o as Qe,cv as Ii,dW as Bs,bu as js,M as Ls,cw as Hn,al as Pi,bd as Di,cx as xa,eW as Bi,ci as Li,b9 as Fi,bc as Hi,dP as Oi,hw as va,gF as Sa,at as Ui,gG as zi,hx as Gi,J as Wi,cF as Vi,b6 as qi}from"./lemv4z8z7gk39eh5.js";import{j as e,r as i,M as L,ac as se,ad as as,c as Ce,as as $i,f as ba,e as On,a as ya,X as Yi,v as Ki,L as vn,R as wa,at as Xi,au as Ji,av as Co}from"./bbqge6n6s1oo3m8q.js";import{aU as mt,hh as Qi,lE as Zi,lF as el,dg as Et,lG as ja,lH as Ma,lI as we,dd as $s,bL as Zt,lJ as Fs,lK as We,ik as Ca,lL as tl,jv as _a,jy as Ta,gG as sl,B as ka,fF as nl,ju as ol,lM as Na,lN as al,lO as rl,lP as Rt,ga as Aa,lQ as V,lR as Ea,lS as Ra,lT as il,lU as ll,lV as cl,lW as dl,lX as ul,lY as ml,lZ as hl,gz as gl,l_ as pl,l$ as fl,m0 as xl,m1 as vl,bz as rs,b1 as Ia,m2 as Sl,m3 as bl,m4 as yl,m5 as Pa,m6 as Da,m7 as wl,m8 as jl,m9 as Ml,ma as Cl,mb as _l,bA as Ys,mc as Tl,md as kl,me as Nl,mf as Al,mg as Ba,mh as Ks,fM as is,mi as Un,ib as zn,ic as ct,id as Gn,E as El,mj as Wn,mk as Rl,fO as It,du as Il,fi as Pl,ml as Dl,mm as Bl,mn as Ll,mo as Hs,mp as Fl,mq as La,mr as Hl,I as Ol,lh as Ul,e1 as Fa,iy as zl,ms as Gl,mt as Wl,bx as Vn,by as Ha,dU as Vl,dV as Oa,co as Ua,cX as ls,mu as ql,mv as $l,mw as _o,mx as To,my as Yl,mz as Kl,bF as ko,bC as Xl,iC as Jl,jZ as No,mA as Ql,mB as Zl,mC as ec,hr as za,mD as tc,mE as sc,bJ as Ga,lp as Ao,gN as Wa,g9 as qn,mF as Eo,h_ as nc,bB as oc,mG as ac,iF as rc,k3 as ic,iG as lc,iD as cc,mH as dc,bD as Sn,mI as uc,mJ as mc,mK as hc,mL as gc,be as bn,mM as pc,cG as $n,U as Os,bZ as Yn,d1 as fc,mN as xc,mO as vc,ie as Sc,ku as bc,kv as yc,mP as wc,mQ as jc,kw as Mc,mR as Cc,mS as _c,mT as Tc,mU as kc,mV as Nc,mW as Ac,dL as Ec,ix as Rc,kG as Ic,mX as Pc,mY as Dc,mZ as Bc,cO as Va,m_ as Lc,m$ as Fc,fN as Hc,n0 as Oc,n1 as Uc,n2 as yn,n3 as zc,n4 as Gc,de as wn,n5 as Wc,n6 as Vc,n7 as qc,n8 as qa,iR as Kn,dh as es,n9 as $c,na as Yc,nb as Kc,nc as jn,j as $a,nd as Ro,ne as Xc,nf as Jc,ng as Qc,nh as Zc,jT as Ya,dc as ed,ni as td,nj as sd,b_ as Xn,hB as Ps,cW as nd,iV as od,nk as ad,a$ as Io,d7 as rd,dI as id,fb as ld,nl as cd,_ as Jn,nm as Xs,im as Ka,iQ as dd,d9 as Xa,nn as ud,aM as md,no as Je,b3 as hd,np as gd,nq as Mn,nr as pd,ns as Ms,nt as Ja,nu as fd,fW as xd,cN as vd,nv as Sd,ge as bd,nw as yd,h$ as Cs,nx as wd,dr as jd,ny as Md,fA as Cd,v as _d,nz as Td,nA as kd,cH as Nd,nB as Ad,nC as Ed,ct as Rd,nD as Id,nE as Qa,nF as Za,nG as er,nH as tr,nI as Ct,d6 as Qn,nJ as Pd,k5 as Dd,nK as sr,nL as Bd,gQ as Us,nM as Cn,nN as Ld,nO as Fd,nP as _s,c2 as Po,b$ as Hd,c0 as Od,cm as nr,cn as or,gi as ar,gk as rr,eJ as Ud,nQ as zd,hb as Gd,nR as Wd,nS as Vd,nT as qd,nU as $d,nV as Yd,nW as Kd,nX as Xd,bw as Jd,dK as Qd,gP as Zd,c3 as eu,nY as tu,nZ as su,fY as Ts,gh as nu,gj as ou,h5 as au,n_ as ru,n$ as iu,o0 as lu,o1 as cu,o2 as du,o3 as uu,o4 as mu,o5 as hu,o6 as gu,o7 as pu,bH as fu,kn as xu,km as vu,o8 as Su,ho as bu,o9 as yu,hs as wu,hu as ju,H as Mu,gs as Cu,i6 as _u,i7 as Tu,oa as ku,ob as Nu,ht as Au,bK as Eu,hp as Ru,oc as Iu,od as Pu,cr as Du,cs as Bu,cq as Lu,cv as Fu,oe as Hu,hv as Do,fC as Ou,c8 as Uu,c9 as zu,hV as Gu,ks as Wu,of as Vu,ia as qu}from"./lt2ef0v2naysiy2l.js";import{i as Zn,s as $u,j as Yu,k as ks,l as Ku,m as Xu,n as Js,C as ir,u as eo,o as Ju,g as Qu}from"./e9ioikt8tbassp1n.js";import{S as lr,a as Zu,b as em,G as tm,L as sm,c as nm}from"./b6besid35puipqnp.js";import{B as om}from"./dii6f0f58vjyxn3r.js";import{C as _n,g as am}from"./pah0un9d5vytizt6.js";const Bo=fe.div`m-8 flex flex-col items-center`;function Lo(t){return e.jsx(se.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function rm({clientThreadId:t}){const o=qe(t,n=>n?.promptGptRating)?.gizmoId,{data:a}=mt(o);return o==null||a==null||!Qi(a)?null:e.jsx(im,{gizmoId:o})}function im({gizmoId:t}){const[s,o]=i.useState(!1),[a,n]=i.useState(!1),r=Zi(t),l=async d=>{o(!0),setTimeout(()=>{n(!0)},5e3),K.logEvent(X.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},c=async()=>{n(!0),K.logEvent(X.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{a||K.logEvent(X.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(Bo,{children:e.jsxs(Lo,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(vo,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(L,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Bo,{children:e.jsxs(Lo,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(vo,{onClick:c})]}),e.jsx(el,{rating:void 0,onRating:l})]})})}const Ns={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},lm=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,a)=>e.jsx(se.div,{initial:Ns.initial,animate:Ns.animate,transition:{delay:(a-1)*Ns.transition.delay},exit:Ns.exit,children:e.jsx(Pt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,a)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(dm,{suggestion:o})},a)},a))});function cm({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const a=t?.length>0;i.useEffect(()=>{a&&Et(t,o)},[a,o]);const{isUnauthenticated:n}=He();return a?t.every(ja)?e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx(ss,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(lr,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(Ma)?e.jsx(lm,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function dm({suggestion:t}){return Ma(t)?e.jsx(e.Fragment,{children:t.text}):ja(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function um(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(mm,{...s}):null}function mm({clientThreadId:t,suggestions:s}){const o=$s();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(hm,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(cm,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const hm=fe.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,cr=({className:t,children:s})=>e.jsx(se.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function gm({currentLeafId:t,canContinue:s,onContinueGenerating:o}){const a=i.useCallback(()=>{const r=new Zt;o(t,r),Fs()},[o,t]);let n=null;return s&&(n=e.jsx(fm,{onHandleContinueGenerating:a})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function pm({className:t}){return e.jsx(Ca,{className:P("-rotate-180",t)})}const fm=({onHandleContinueGenerating:t})=>e.jsx(cr,{children:e.jsx(Pt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:pm,size:"small",children:e.jsx(L,{...We.continueGenerating})})}),xm=({clientThreadId:t})=>{const s=ia(),o=zs(t),a=lt(o);i.useEffect(()=>{a&&So.dismissBanner()},[a]);const n=s?.is_dismissible?()=>So.dismissBanner():void 0;return e.jsx(as,{children:s&&e.jsx(se.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(tl,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function vm(t){const s=zs(t),o=lt(s),a=ia();return!o&&a!=null}const Tn=window.sessionStorage,kn=Xr(Jr(()=>({memoryFullBannerDismissed:!!Tn?.getItem(gn.MemoryFullBannerDismissed)}))),dr={dismissBanner(){kn.setState(t=>{t.memoryFullBannerDismissed=!0}),Tn?.setItem(gn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){kn.setState(t=>{t.memoryFullBannerDismissed=!1}),Tn?.removeItem(gn.MemoryFullBannerDismissed)}};function Sm(t){const s=Ae(t),o=_a(),{data:a}=Ta(s,!1,o),n=a!=null,r=n&&a.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),dr.clearDismissedBanner())},[r,n]);const d=kn(h=>h.memoryFullBannerDismissed);return r&&l&&!d}function bm(){const t=Ce(),{openSettings:s}=sl();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(ka,{title:t.formatMessage(As.memoryFullTitle),content:t.formatMessage(As.memoryFullTooltip,As.memoryFullTooltip.values),primaryCtaText:t.formatMessage(As.memoryManageButton),onPrimaryCtaClick:()=>s(nl.Personalization),onDismiss:()=>dr.dismissBanner()})})}const As=$e({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:ol,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),ym=()=>{const{shouldShowSkipButton:t}=Na();return t?e.jsx(cr,{className:"flex justify-center",children:e.jsx(Pt,{as:"button",color:"secondary",onClick:()=>al.skipParagen(),children:e.jsx(L,{...wm.skip})})}):null},wm=$e({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),jm=Oe(()=>Ue(()=>import("./gecewc5711hvt8ct.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.JawboneNotificationsBanner)),ur=i.memo(function({className:s}){const{store:o}=we(),a=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:P(s??"absolute bottom-full left-0 right-0",Ra.PromptTextareaHeader),children:e.jsx(rl,{shouldRender:a,contentArea:Rt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(mr,{}),e.jsx(hr,{})]})})})});function mr(){const{store:t}=we(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(Rt.HeaderTop),a=Aa();let n;switch(o){case V.ProjectConversationAutoChangeModel:n=e.jsx(km,{});break;case V.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(hl,{clientThreadId:s});break;case V.ParagenControls:n=e.jsx(ym,{});break;case V.ItemActions:n=e.jsx(um,{});break;case V.BannerSignup:n=e.jsx(_m,{});break;case V.BannerTermsDisclaimer:n=e.jsx(Nm,{});break;case V.PromptTextareaAction:n=e.jsx(Am,{});break;case V.BannersRateLimit:n=e.jsx(Em,{});break;case V.BannerSidekickAnnouncement:n=e.jsx(ml,{});break;case V.SearchBrowserExtensionAnnouncement:n=e.jsx(ul,{});break;case V.MemoryInSearchAnnouncement:n=e.jsx(dl,{});break;case V.MoonshineAnnouncement:n=e.jsx(cl,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(ll,{});break;case V.BannerMemoryFull:n=e.jsx(bm,{});break;case V.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:a?n=e.jsx(jm,{}):n=null;break;case V.JawboneMaxActiveAnnouncement:a?n=e.jsx(il,{}):n=null;break;default:n=null;break}return n}function hr(){const{store:t}=we(),s=t.useContentAreaId(Rt.HeaderBottom);let o;switch(s){case Ea.DallePromptControls:o=e.jsx(Cm,{});break;default:o=null;break}return o}const Mm=Oe(()=>Ue(()=>import("./gcncyg0taymxf4pk.js"),__vite__mapDeps([8,1,3,4,2,5,9])).then(t=>t.default));function Cm(){const{store:t}=we(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(Mm,{composerController:s}):null}function _m(){const{store:t}=we(),s=t.useSharedProps(n=>n?.clientThreadId),o=gl(),a=pl();return s?o?e.jsx(fl,{threadId:s,showSignUp:a}):e.jsx(xl,{threadId:s,showLogin:a}):null}function Tm({clientThreadId:t}){const s=rs(t);return e.jsx(ka,{icon:e.jsx(Ia,{}),content:e.jsx(L,{id:"IJzX01",defaultMessage:"The model {modelName} does not support project files or instructions. Your conversation will continue with GPT-4o.",values:{modelName:s?.title}})})}function km(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Tm,{clientThreadId:s}):null}function Nm(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(vl,{threadId:s}):null}function Am(){const{store:t}=we(),s=t.useSharedProps();return s?e.jsx(gm,{...s}):null}function Em(){const{store:t}=we(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(xm,{clientThreadId:s}):null}const Rm=i.memo(function(s){return Im(s),Pm(s),Dm(),null});function Im(t){const{store:s}=we(),o=s.useSetSharedProps();pn(()=>{o(t)},[t,o])}function Pm(t){const{clientThreadId:s,canContinue:o}=t,{store:a}=we(),n=i.useRef({top:a.useContentAreaApi(Rt.HeaderTop),bottom:a.useContentAreaApi(Rt.HeaderBottom)}).current,r=Fm(t),l=Sl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:d}=Hm(s),h=vm(s),u=bl(t),m=yl(t),g=Pa(),v=Da(),M=wl(t),p=Sm(s),j=jl(),b=Ml(t),_=Cl(s),C=_l(s),w=qe(s,k=>k?.modelId),x=Ys(s);pn(()=>{w&&x?.kind===Ve.GizmoInteraction&&x.gizmo&&Al(w,x.gizmo)?n.top.set(V.ProjectConversationAutoChangeModel):b.eligible?n.top.set(V.AdvancedVoiceOnMobileAnnouncement):j?n.top.set(V.ParagenControls):d?n.top.set(V.BannerTermsDisclaimer):h?n.top.set(V.BannersRateLimit):_?n.top.set(V.JawboneAnnouncement):C?n.top.set(V.JawboneMaxActiveAnnouncement):u.eligible?n.top.set(V.BannerSidekickAnnouncement):g?n.top.set(V.MemoryInSearchAnnouncement):v?n.top.set(V.MoonshineAnnouncement):m?n.top.set(V.SearchBrowserExtensionAnnouncement):M?n.top.set(V.SearchBrowserExtensionReactiveAnnouncement):r?n.top.set(V.ItemActions):o?n.top.set(V.PromptTextareaAction):c?n.top.set(V.BannerSignup):p?n.top.set(V.BannerMemoryFull):n.top.set(null)},[n,r,o,d,c,h,u,p,j,b]),pn(()=>{l&&n.bottom.set(Ea.DallePromptControls)},[n,l])}function Dm(){const{store:t}=we();i.useEffect(()=>()=>{t.reset()},[t])}function Bm(t){const s=Ba(),o=dt(t),a=J.getTree(t).getLastValidNode(o)?.message?.id;return s?.messageId===a?s.suggestions:[]}function Lm(t){return Bm(t).length>0}function Fm(t){const s=Tl(t.clientThreadId),o=Lm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||o}function Hm(t){const{isUnauthenticated:s}=He(),o=dt(t),{layer:a}=Tt("3637408529"),n=a.get("should_show_no_auth_signup_banner",!0),r=kl(g=>g.bannerDisclaimerClientThreadId),l=Nl(),c={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return c;const d=J.getTree(t),h=d.countMessagesByAuthor(Ne.User),u=d.getNodeByIdOrMessageId(o),m=u?.message?.author.role===Ne.Assistant&&Qr(u.message);return c.shouldShowBannerTermsDisclaimer=m&&s&&h===1&&!l&&(r==null||r===t),c.shouldShowBannerSignup=n&&m&&s&&h>0&&h%5===0,c}function Om({composerController:t,isDisabled:s,highlightTooltip:o,clientThreadId:a}){const{setThreadSearchMode:n}=Ks(),r=is(),l=$i(),[c,d]=i.useState(!1),h=Ce(),u={clientThreadId:a};return e.jsx(zm,{highlightTooltip:o,analyticsMetadata:u,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:P("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",c&&"transition-all duration-150",r||o?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":h.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>d(!1),onClick:m=>{m.stopPropagation(),m.preventDefault(),d(!0),K.logEventWithStatsig(X.composerSearchButtonClicked,"composer_search_button_clicked",u),n(!r,u,kt.CONVERSATION_COMPOSER_WEB_ICON),r||(t.trimLeadingText(/^search\b/i),t.removeSystemHints(),t.focus())},children:[e.jsx(Un,{}),e.jsx(as,{children:r&&e.jsx(se.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:l?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(L,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function Um(){const t=Pa(),s=Da(),o=zn(ct.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function zm({children:t,highlightTooltip:s,analyticsMetadata:o,isThreadUsingSearchMode:a,isDisabled:n}){const r=Um()&&!a,l=zn(ct.hasSeenComposerSearchButtonTooltip);return r?e.jsx(Gn,{announcementKey:ct.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(L,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(L,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(El,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(L,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(ns,{sideOffset:0,label:n?e.jsx(L,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(L,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(a?!1:void 0),onOpenChange:c=>{c&&K.logEventWithStatsig(X.composerSearchButtonHovered,"composer_search_button_hovered",o)},children:t})})}function Gm({composerController:t,clientThreadId:s}){const o=os(s),a=is(),{setThreadSearchMode:n}=Ks(),r=Wn(s),[l,c]=i.useState([]),[d,h]=i.useState(void 0),[u,m]=i.useState(0);i.useEffect(()=>{c(d?r.filter(x=>x.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||x.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{t.view.dispatch($u(t.view.state.tr,{onHintMatch(x){h(k=>la(k,x)?k:x)}}))},[t]);const g=!r.length||!l.length||!d;i.useEffect(()=>{g&&m(0)},[g]);const v=l.length,M=i.useCallback(x=>{m(k=>(x(k)%v+v)%v)},[v]),p=l[u],j=({hintToSave:x=p,expectPerfectMatch:k})=>{if(!d||!p||k&&x.name.toLowerCase()!==d.text.toLowerCase())return!1;K.logEvent(X.systemHintSelected,{system_hint:x.systemHint,conversation_id:o??bo});const G=d.range.from===1?x.name:d.text+x.name.slice(d.text.length),E={clientThreadId:s};return ks(t.view),x.systemHint===It.Search?(n(!0,E,kt.CONVERSATION_COMPOSER_SLASH_SEARCH),d.range&&t.delete(d.range.from,d.range.to),t.removeSystemHints(),!0):(a&&n(!1,E,kt.CONVERSATION_COMPOSER_SLASH_SEARCH),t.addSystemHint(x.systemHint,G,d.range.from,d.range.to),!0)},b=i.useRef(j);b.current=j;const _=i.useRef(M);_.current=M;const C=i.useRef(d);C.current=d;const w=t.view;return i.useEffect(()=>(g||Yu(w,x=>{if(x==="up")_.current(k=>k-1);else if(x==="down")_.current(k=>k+1);else if(x==="cancel")ks(w),Ku(w);else{if(x==="submit")return ks(w),b.current({expectPerfectMatch:!1});if(x==="checkMatch")return b.current({expectPerfectMatch:!0})}}),()=>ks(w)),[g,w]),i.useEffect(()=>{g||K.logEvent(X.systemHintListOpened,{conversation_id:o??bo})},[g]),g?null:e.jsx(Zr,{className:"max-w-60",onMouseDown:x=>{x.preventDefault()},children:l.map((x,k)=>e.jsx("div",{onMouseOver:()=>m(k),onClick:()=>{j({hintToSave:x,expectPerfectMatch:!1}),t.focus()},children:e.jsx(ei,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:k===u,children:e.jsx(gr,{title:x.name,description:x.description,logo:x.logo})})},x.systemHint))})}function gr({title:t,description:s,logo:o,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Rl,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),a&&e.jsx(ti,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Wm({composerController:t,clientThreadId:s}){return t instanceof Zn?e.jsx(Gm,{composerController:t,clientThreadId:s}):null}function Vm({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(se.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function qm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:d,isDisabled:h,highlightTooltip:u}){const m=Il(),{gdriveStatus:g,o365Status:v}=Pl(),M=e.jsx(Ll,{className:d?"text-white":u?"text-brand-blue-800":void 0}),p=g!=="false"||v!=="false"||m;return e.jsx("div",{className:"relative",children:e.jsx(Vm,{showBackground:u,className:"bg-brand-blue-800/20",children:p?e.jsx(Dl,{clientThreadId:t,icon:M,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:h,highlightTooltip:u}):e.jsx(Bl,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:M,isDisabled:h,highlightTooltip:u})})})}function $m({suggestions:t,composerController:s,onSelect:o,onChange:a}){const n=$s(),r=i.useCallback((u,m,g)=>{o?.(u,m,g),n(u,m,g)},[o,n]),[l,c]=i.useState(-1),[d,h]=i.useState(!1);return i.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const g=l===t.length-1?0:l+1;c(g),a?.(g,!0,t[g])}else if(m.key==="ArrowUp"){m.preventDefault();const g=l<=0?t.length-1:l-1;c(g),a?.(g,!0,t[g])}else m.key==="Enter"&&!m.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,a,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),a?.(-1,!1)}),[s,a]),i.useEffect(()=>{if(!d){const u=()=>{h(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[d]),i.useEffect(()=>{c(-1),a?.(-1,!1),h(!1)},[t,a]),e.jsx(se.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(se.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(u,t,m)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{d&&(c(m),a?.(m,!1,u))},onMouseLeave:()=>{c(-1),a?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((g,v)=>e.jsx("span",{className:P(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:P(u.type===Hs.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function Ym(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const a=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(a.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(a.forEach(c=>{if(c>l){const d=o.slice(l,c);d&&r.push({text:d,isMatched:!1})}r.push({text:o[c],isMatched:!0}),l=c+1}),l<s.length){const c=o.slice(l);c&&r.push({text:c,isMatched:!1})}return Km(r)}function Km(t){if(t.length===0)return t;let s=[t[0]];for(let a=1;a<t.length;a++){const n=s[s.length-1],r=t[a];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const o=s.filter(a=>a.isMatched).reduce((a,n)=>a+n.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(a=>a.text).join(""),isMatched:!1}]}const Xm=i.forwardRef(function({type:s,placeholder:o,replyRegions:a,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:d,inputState:h,currentLeafId:u,composerController:m,clientThreadId:g,gizmoId:v,disableReason:M},p){const j=ze(),b=Fl();let _=null;const{isLoading:C}=b;C||(_=b.modelId),i.useEffect(()=>{C||si()||m.focus()},[_,m,C]);const w=x=>{sh({target:x.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||m.focus()};return e.jsxs("div",{id:"composer-background",ref:p,className:P("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",j&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",j&&s!=="temporary"&&"bg-token-composer-surface",!j&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:w,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(as,{initial:!1,children:a.length>0&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Qm,{replyRegions:a})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:m instanceof La?e.jsx(Jm,{composerController:m,currentLeafId:u,placeholder:o,inputState:h}):e.jsx(Xu,{composerController:m,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:l}),e.jsx(Hl,{inputState:h,state:n,onSubmit:d,composerController:m,clientThreadId:g,gizmoId:v,disableReason:M})]})]})]})});function Jm({composerController:t,currentLeafId:s,placeholder:o,inputState:a}){const n=i.useContext(ni);return e.jsxs(e.Fragment,{children:[e.jsx(Ol,{id:Ul,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof La))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:o,disabled:a!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",a==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Qm({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,o)=>{switch(s.type){case"text":return e.jsx(Zm,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"object":return e.jsx(eh,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"mention":case"system_hint":return e.jsx(th,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},o)}})})}function Zm({value:t,onRemoveRegion:s}){return e.jsxs(so,{className:"text-token-text-secondary",children:[e.jsx(no,{children:e.jsx(Fa,{className:"icon-lg-heavy"})}),e.jsx(oo,{children:`“${t}”`}),e.jsx(to,{onClick:s})]})}function eh({value:t,onRemoveRegion:s}){return e.jsxs(so,{className:"text-blue-selection",children:[e.jsx(no,{children:e.jsx(Fa,{className:"icon-lg-heavy"})}),e.jsx(oo,{className:"font-semibold",children:t}),e.jsx(to,{onClick:s})]})}function th({value:t,icon:s,onRemoveRegion:o}){return e.jsxs(so,{children:[e.jsx(no,{className:"mt-0",children:s}),e.jsx(oo,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(to,{onClick:o})]})}function to({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(zl,{className:"icon-lg"})})}const so=fe.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,no=fe.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,oo=fe.span`flex-1 line-clamp-3 py-0.5`;function sh({target:t,rootId:s,additonalInteractiveIds:o}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||o.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const nh=({composerController:t,disabled:s,clientThreadId:o})=>{const a=is(),{setThreadSearchMode:n}=Ks(),r=Wn(o),l=t.useState(p=>p.getSystemHints()[0]),c=a?It.Search:l,[d,h]=i.useState(!1);if(i.useEffect(()=>{const p=Math.random(),j=setInterval(()=>{const b=new Date,_=b.getHours()+b.getMinutes()/60+b.getSeconds()/3600,C=Math.abs((6+_)%12-6)/6;h(Math.pow(C,15)>p)},1e3);return()=>clearInterval(j)},[]),!(t instanceof Zn))return null;const u=t,m={clientThreadId:o};function g(){K.logEventWithStatsig(X.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",m)}function v(){K.logEventWithStatsig(X.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",m)}function M(p,j){if(p.systemHint===It.Search){n(j,m,kt.CONVERSATION_COMPOSER_TOOL_MENU),u.removeSystemHints(),setTimeout(()=>{u.focus()},0);return}j?(a&&n(!1,m,kt.CONVERSATION_COMPOSER_TOOL_MENU),u.addSystemHint(p.systemHint,p.name),setTimeout(()=>{u.focus()},0)):u.removeSystemHints()}return e.jsx(oh,{systemHints:r,selectedHint:c,showJack:d,disabled:s,onHover:g,onOpen:v,onSelect:M})},oh=({systemHints:t,selectedHint:s,showJack:o,disabled:a,onHover:n,onOpen:r,onSelect:l})=>{const c=Ce(),[d,h]=i.useState(!1);return e.jsxs(Q.Root,{open:d,onOpenChange:u=>{h(u),u&&r?.()},children:[e.jsx(ah,{disabled:!!a,children:e.jsx(En,{className:P(Gl.toolsButton,"flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":Fo(d),"data-jack":Fo(!!o),"aria-label":c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:a,onPointerOver:n,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(Wl,{className:"pointer-events-none"})})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},children:t.map(u=>e.jsx(Q.Item,{className:"px-1 py-2",onClick:()=>l?.(u,u.systemHint!==s),children:e.jsx(gr,{title:u.name,description:u.description,logo:u.logo,checked:u.systemHint===s})},u.systemHint))})})]})},ah=({disabled:t,children:s})=>{const o=zn(ct.hasSeenComposerSystemHintButtonTooltip);return!t&&!o.isLoading&&o.eligible?e.jsx(Gn,{announcementKey:ct.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(L,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(L,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:s}):e.jsx(ns,{side:"right",sideOffset:0,label:t?e.jsx(L,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(L,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Fo(t){return t?"":null}const rh=1,ih=3e3;function lh({files:t,className:s}){const o=Ds(),a=Ha(),n=Nc();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(Ac,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(Ec,{borderRadius:"2xl",useV2Style:!0,width:o?"normal":"wide",onRemoveFileClick:()=>Sn.remove(a,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Rc.Uploading?r.progress:void 0},r.tempId))]})}function ch({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:a,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:d=!1,disabledReason:h,canPause:u=!1,canContinue:m=!1,suggestions:g,isInteractableSharedThread:v,composerContainerRef:M,autocompletions:p,requiresFileUpload:j,onComposerInput:b,onComposerChange:_,onAutocompleteSelect:C,headerClassName:w,hideHeader:x,setComposerBarElement:k,onTaggingDropdownOpen:G,onTaggingDropdownClose:E}){const H=i.useRef(null),I=Ic(H,k),f=Js(),A=Vn(),R=Gs(),{isUnauthenticated:D}=He(),W=Ce(),y=ca(),z=Ha(),S=dt(n),F=zs(n),[Z]=ba(),$=On(),{gizmoEditorData:q,mode:re,getGizmoId:me}=Vl(),ee=da(),xe=oi(),he=ut(),De=Oa(),ie=os(n),_e=!!ai(),ve=!!Rn(),[je,Ee]=i.useState({}),{setThreadSearchMode:Be,clearSearchModeTrigger:Ge,getSearchModeTrigger:Ye}=Ks(),ne=is(),[B,N]=i.useState(!1),[U,te]=i.useState(!1),le=ze(),oe=i.useRef(!1),Se=Ua(),ae=a!==null?Se[a]:void 0,Te=qe(n,T=>T?.overrideModelId);let Y=Ys(n),be=Y&&"gizmo"in Y?Y.gizmo:void 0;const Le=ls(be?.gizmo.id),ge=ql(),ht=$l();let Dt;be?.gizmo.id&&(Le?Dt=_o.PROJECT:Dt=_o.GPT);const[pe,Xe]=i.useState(null);pe!==null&&(Y={gizmo:pe,gizmo_id:pe.gizmo.id,kind:Ve.GizmoInteraction},be=pe);const gt=To(ae,Y);let Bt=!1;Yl(Y)&&be?.gizmo.id===Kl&&(Bt=!0);const cs=ri(),pt=!d&&!Bt&&gt!==ko.None&&!D,tt=Xl(ae,Y),Lt=Jl(ae,Y);let Re=No(T=>T.files);const[Ft]=i.useState(()=>Ql());re==="magic"?Re=Re.filter(T=>T.gizmoId!=null):Re=Re.filter(T=>T.gizmoId==null);const ds=Zl(),ft=Re.length>0||ds,Ht=No(Pc.hasUploadInProgress),Ot=f.useState(T=>{const de=ec(T);return typeof ae?.maxTokens=="number"&&de>ae.maxTokens}),Ut=f.useState(T=>!T.isEmpty()),Ke=!Ot&&!Ht&&(Ut||ft);za(Re.length>0||Ht||Ut);const zt=(gt===ko.Multimodal?tc:sc)-Re.length,us=zt<=0,Fe=Ke&&!d&&!l&&!ve,[ms,xt]=i.useState(!1),Gt=Ga(),st=a||Gt.id,Wt=Ao(n,yo.Search),hs=!d&&!be&&ee?.includes(Is.SearchTool)&&!ee?.includes(Is.SearchToolHoldout)&&(ee?.includes(Is.BrowsingAvailable)||!R?.isEnterprisey()),Vt=hs&&Wt,Qs=Se[st]?.tags,{targetedContent:qt,setTargetedContent:vt}=Wa(),ye=qt?.isFocusedViewContent&&!De?void 0:qt,{rebaseSystemMessageContent:gs}=qn();i.useEffect(()=>{if(!A?.id)return;const T=Eo.getAndReset(A?.id,ie);T&&f.setText(T.inputText)},[A?.id,ie,f]),i.useEffect(()=>{const T=Z.get("prompt")??"";f.getCurrentText().length===0&&T.length>0&&f.setText(T)},[f,Z]),i.useEffect(()=>{ms!==Fe&&(xt(Fe),Fe&&ii(!0).then(T=>{nc.startEnforcement(T),li.startEnforcement(T)}))},[Fe,ms,Y?.kind,ee]);const St=oc(ae,Y),{handleFileAccepted:io}=ac(W,To(ae,Y),tt,"mouse",me,St?.attachments),{getInputProps:Zs,open:ps}=rc({disabled:d||!pt||us,noClick:!0,onDropAccepted:io,onDropRejected:T=>ic(T,W,y,gt),multiple:!0,maxSize:lc,maxFiles:zt,...cc(Lt)}),en=ci(Ft),fs=i.useCallback(()=>{f.eraseContent(),en.clearMessages(),f.resize(rh),J.clearOverrideModelId(n),dc();for(const T of Re)Sn.remove(z,T.tempId,"none");uc.markAllAsSent()},[f,en,Re,z,n]),bt=async(T,de)=>{if(T?.preventDefault(),d||!Ke&&!de||!Y||Nt.isLoading(n)!==!1)return;const Ie=new Zt({gizmoType:Dt});N(!0),ge?.(),ht?.();const Me=f.getContentToSend(),at=Dc(Me.content),an=`${S}-nextPrompt`,Kt=new Bc(Va.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Yr,attachments:ho}=Lc(z,at,ae,Y),go=[],rn=[];gs&&rn.push(mi(gs));const ln={...Y};"gizmo"in ln&&delete ln.gizmo;let ws=f.getSystemHints();ne&&(ws=[It.Search]);const po=Ye(),Kr=ne?po??kt.CONVERSATION_COMPOSER_WEB_ICON:void 0,fo=Fc(),xo=Hc();let Xt={promptId:an,content:Yr,eventMetadata:{eventSource:T?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:ln,systemHints:ws,searchSource:Kr},messageMetadata:{...ho.length>0&&{attachments:ho},...pe&&{gizmo_id:pe?.gizmo.id},...je,...ws.length>0&&{system_hints:ws},...!!Me.metadata&&{serialization_metadata:Me.metadata},...fo.length>0&&{canvas:{user_created_textdocs:fo.map(Jt=>({user_created_temp_textdoc_id:Jt.tempTextdocId,type:Jt.type,title:Jt.title,content:Jt.content,create_source:Jt.create_source}))}},...Object.keys(xo).length>0&&{__internal:{search_settings:xo}}},prependMessages:go.length>0?go:void 0,appendMessages:rn.length>0?rn:void 0,turnTracker:Ie,profiler:Kt,requestedModelId:Te};Xt=Oc(Xt),ye?.createNewCompletionParams&&(Xt=await ye.createNewCompletionParams(Xt)),Kt.logTiming("request_params_ready"),await s(Xt),ye?.onCreateCompletion?.({serverThreadId:ie,currentLeafId:S}),ye?.shouldPersistAcrossMessages!==!0&&vt(void 0),Os.hideThreadHeader(),fs(),N(!1),Kt.logTiming("prompt_submitted"),g!==void 0&&(ue.logEvent("chatgpt_prompt_ignore_suggestions"),K.logEvent(X.promptIgnoreSuggestions)),ne&&po&&Ge()},tn=i.useRef(bt);i.useEffect(()=>{tn.current=bt});const sn=T=>{vt(T.targetedReply),T.targetedReply&&(f.focus(),K.logEvent(X.targetedReplyButtonClicked,{conversationId:ie,sourceMessageId:T.messageId}))},xs=i.useCallback(()=>{ye?.onCleared?.({serverThreadId:ie,currentLeafId:S}),vt(void 0),f.focus()},[S,ie,ye,vt,f]),vs={Enter:{validator:T=>{const de=T.isComposing||T.keyCode===229;return!(U&&oe.current)&&(T.metaKey||(xe||hi)&&!T.shiftKey&&!de)},handler:T=>{if(!Fe){Ot&&y.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}T.preventDefault(),bt()}},Escape:{validator:T=>!T.isComposing,handler:T=>{u&&l&&(t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(n),currentLeafId:J.getTree(n).getMessageId(S),eventSource:"keyboard"})),T.target.value===""&&xs()}}},nt=i.useRef(vs);nt.current=vs;const yt=mc(Qs,Y?.kind),[$t,wt]=i.useState(!1),[O,ce]=i.useState(!1),ke=yt&&$t&&!Le,ot=f.isReady();i.useEffect(()=>f.subscribe("keydown",T=>{f.acceptLegacyKeydown()&&nt.current[T.key]?.validator(T)&&nt.current[T.key].handler(T);const Ie=f.getCurrentText();if(T.key==="@"){const Me=f.getSelectionStart(),at=Ie.substring(0,Me);(!at||/\s$/.test(at)||Me===0)&&setTimeout(()=>wt(!0),10)}else $t&&wt(!1);if(T.key==="Escape"&&(Xe(null),te(!1)),Vt&&!ne){let Me;T.key==="Backspace"?Me=Ie.substring(0,Ie.length-1):Me=Ie+T.key,/^search\s?$/i.test(Me)?ce(!0):O&&ce(!1)}ne&&T.key==="Escape"&&Be(!1,{clientThreadId:n})}),[f,ot,$t,O,Vt,ne,Be,n]),i.useEffect(()=>{const T=Object.fromEntries(Object.keys(nt.current).map(de=>[de,Me=>{const at=nt.current[de];if(!at||f.acceptLegacyKeydown())return!1;const{validator:an,handler:Kt}=at;return an(Me)?(Kt(Me),!0):!1}]));f.registerKeyHandlers(T)},[f,ot]),i.useEffect(()=>f.subscribe("paste",T=>{hc({filePickerStore:z,event:T,intl:W,toaster:y,clientThreadId:n,conversationMode:Y,currentModelConfig:ae,getEditorGizmoId:me,modelSupportedImageMimeTypes:tt})}),[W,n,Y,ae,me,tt,f,y,z]);const nn=T=>{_e||Xe(T),f.trimLeadingText("@"),Fs(),wt(!1)},_r=gc(n,Ft,tt,St?.attachments),Tr=i.useCallback(T=>{T?.preventDefault(),t("",F),K.logEvent(X.pauseCompletion,{threadId:J.getServerThreadId(n),currentLeafId:J.getTree(n).getMessageId(S),eventSource:"mouse"}),Fs()},[t,n,F,S]),lo=i.useCallback(()=>{Eo.set(A?.id,ie,f.getCurrentText())},[ie,A?.id,f]);i.useEffect(()=>{q||!B&&!di()&&f.focus()},[B,f]),i.useEffect(()=>{q||Sn.reset(z)},[a,z,q]),i.useEffect(()=>{(!yt&&pe||_e)&&Xe(null)},[yt,pe,_e]);const[co,kr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[We.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[We.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[We.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[We.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[We.loading,!0];case"noTestGizmoId":return[We.noTestGizmoId,!0];default:return v?[We.placeholderWithName,!1]:ye?.placeholderTextOverride!=null?[ye.placeholderTextOverride,!1]:[We.placeholderWithName,!1]}})(),Nr=Le?r?W.formatMessage(bn.newChatInProject):W.formatMessage(co,{name:"ChatGPT"}):W.formatMessage(co,{name:q!=null?re==="magic"?pc:q.name||"GPT":be?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>f.subscribe("input",()=>{$n.getState().isThreadHeaderVisible&&Os.hideThreadHeader(),te(!0)}),[f]),i.useEffect(()=>{if(b)return f.subscribe("input",()=>{b?.()})},[f,b]),i.useEffect(()=>{if(_)return f.subscribe("change",()=>{_?.()})},[f,_]),i.useEffect(()=>f.subscribe("focus",()=>{te(!0)}),[f]);const Ar=Wn(n).length>0,Er=Y?.kind===Ve.PrimaryAssistant||Y?.kind===Ve.GizmoInteraction&&Le,Ss=Ar&&Er,Rr=Ds(),Ir=Ss&&!Rr,Pr={clientThreadId:n,uploadType:gt,modelAcceptedMimeTypes:Lt,modelSupportedImageMimeTypes:tt,attachmentsProductFeature:St?.attachments,getInputProps:Zs,openFileDialog:ps,historyDisabled:he,onOauthRedirect:lo,highlightTooltip:j&&!ft},bs=[],Dr=!d&&!us&&(pt||cs!=null)&&!ne;bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(qm,{...Pr,isDisabled:!Dr})},"file-upload-button")),Ir&&bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(nh,{composerController:f,clientThreadId:n,disabled:!Ss})},"system-hint-button")),hs&&bs.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(Om,{composerController:f,highlightTooltip:O,clientThreadId:n,isDisabled:!Vt||ft})},"search-button"));const Br=ft&&e.jsxs(e.Fragment,{children:[re==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(L,{...We.gizmoKnowledgeWarning})}),e.jsx(lh,{files:Re,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Lr=kr?"disabled":"default",Fr=l&&u,Hr=ui(),Or=!Fe||B||Hr,Ur=Uc(Ht,Ut,Ot),ys=Fr?"streaming":Or?"disabled":"idle",Yt=i.useRef(null),jt=i.useRef(null),zr=a&&a.startsWith("o1");i.useEffect(()=>{const T=()=>{Yt.current!=null&&fn.addAction("composer_state_disabled",{threadId:J.getServerThreadId(n),disabledReason:Yt.current})};if(Ke&&ys==="disabled"){let de="unknown";d?de=h??"component_disabled_unknown":l?de="completion_in_progress":ve?de="thread_hard_blocked":B&&(de="starting_new_completion_request"),Yt.current!==de&&(jt.current&&clearTimeout(jt.current),jt.current=setTimeout(T,ih)),Yt.current=de}else Yt.current=null;return()=>{jt.current&&(clearTimeout(jt.current),jt.current=null)}},[n,Ke,ys,d,h,l,ve,B]);const on=[];if(ye?.label&&on.push({type:ye.type,value:ye.label,onRemoveRegion:xs}),pe!==null){const T=!!pe.gizmo.tags?.includes(Yn.FirstParty);on.push({type:"mention",value:pe.gizmo.display.name,icon:e.jsx(fc,{isFirstParty:T,src:pe.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Xe(null),f.focus()}})}i.useEffect(()=>{(!p||p.length===0||!U)&&(oe.current=!1)},[p,U]);const Gr=(T,de,Ie)=>{oe.current=T>=0,de&&f.setText(Ie?`${Ie.title}${Ie.body}`:"")},uo=U&&p&&p.length>0&&!ke&&!f.hasMultipleLines()&&f.canShowAutocompletion();i.useEffect(()=>{ke?G?.():E?.()},[ke,G,E]);const mo=ys==="streaming"?Tr:bt,Wr=Ao(n,yo.Canvas),{value:Vr}=In("61299031"),qr=Ds(),$r=Wr&&Vr&&!ds&&!qr;return e.jsxs(xc.Provider,{value:Ft,children:[e.jsx(vc,{onOauthRedirect:lo,children:e.jsx("form",{className:c,onSubmit:mo,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!x&&!le&&e.jsx(ur,{className:w}),e.jsxs("div",{ref:M,className:"group relative flex w-full items-center",children:[r&&Z.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{$("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Sc,{className:"icon-lg"})}),e.jsxs(bc,{open:ke||Ss,children:[e.jsx(yc,{className:"w-full",children:e.jsx(Xm,{type:he?"temporary":"default",ref:I,replyRegions:on,placeholder:Nr,inputState:Lr,composerController:f,leftSideActions:bs,topRightAction:$r&&e.jsx(wc,{composerRef:H,composerController:f,clientThreadId:n}),state:ys,onSubmit:mo,renderFiles:Br,currentLeafId:S,clientThreadId:n,gizmoId:be?.gizmo.id,disableReason:Ur,modelId:st})}),e.jsx(jc,{children:e.jsxs(Mc,{side:"bottom",align:"start",sideOffset:12,children:[ke&&e.jsx(Cc,{onClick:T=>nn(T),onClose:()=>{wt(!1),f.focus()}}),Ss&&e.jsx(Wm,{composerController:f,clientThreadId:n})]})})]}),uo&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx($m,{suggestions:p,composerController:f,onSelect:C,onChange:Gr})})]}),e.jsx(_c,{composerController:f,parsedDocumentHandler:_r})]})})}),e.jsx(Rm,{canUseInlineTagging:yt,isDisabled:d,clientThreadId:n,currentLeafId:S,currentRequestId:F,canContinue:m,composerController:f,setPromptInputMetadata:Ee,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:fs,conversationMode:Y,isShowingAutocomplete:!!uo}),Y!=null&&!zr&&Tc.includes(Y.kind)&&e.jsx(kc,{clientThreadId:n,onTargetedReply:sn})]})}function dh(t){const s=t.message?.author.role===Ne.User,o=t.metadata?.err!=null&&t.metadata?.errCode!==jo.ContentPolicy,a=t.metadata?.errCode===jo.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:s||o}function uh(t){return e.jsx(ir,{clientThreadId:t.clientThreadId,children:e.jsx(mh,{...t})})}function mh({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:a,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const c=Js(),d=Dn(),h=Bn(),u=qs(g=>{const v=Nt.getCurrentNode(t,g);return dh(v)});if(qa(c),!h&&u)return e.jsx(hh,{clientThreadId:t});const m=e.jsx(e.Fragment,{children:e.jsx(pr,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:a,onRequestCompletion:r})});return n?m:e.jsxs(e.Fragment,{children:[e.jsx(rm,{clientThreadId:t}),e.jsx(Kn,{clientThreadId:t,isStaticSharedThread:d,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx(es,{children:m})})]})}function hh({clientThreadId:t}){const s=$c(t),o=qs(r=>Nt.getCurrentNode(t,r).metadata?.errCode===Yc),a=Kc(r=>r.isoDate),n=dt(t);return o&&a!=null&&a!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(L,{...Ho.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Pt,{as:"button",color:"primary",onClick:()=>{const r=new Zt;ue.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Ze({clientThreadId:t})),s({id:n,eventMetadata:{eventSource:"mouse"},conversationMode:Nt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:Ca,"data-testid":"regenerate-thread-error-button",children:e.jsx(L,{...Ho.regenerateResponse})})})]})}function pr({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:a,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:M}){const p=dt(t),j=zs(t),b=yn(),{isUnauthenticated:_}=He(),w=ua(t)===ma.STREAMING,x=ha({clientThreadId:t,conversationLeafId:p}),k=lt(j),G=gi({clientThreadId:t}),E=!_,H=pi(),{isOpen:I,onClose:f}=zc({type:"just-hit-rate-limit"}),A=i.useCallback((B,N)=>{K.logEvent(X.continueCompletion),a({type:wo.Continue,promptId:B,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Nt.getConversationMode(t)},turnTracker:N})},[a,t]),R=ya(),D=i.useCallback(async(B,N)=>Gc({clientThreadId:t,currentRequestId:N,isHistoryAndTrainingDisabled:H,queryClient:R}),[t,H,R]),W=i.useCallback(async({promptId:B,content:N,eventMetadata:U,completionMetadata:te,messageMetadata:le,prependMessages:oe,appendMessages:Se,turnTracker:ae,profiler:Te,requestedModelId:Y})=>{const be=J.getThreadCurrentLeafId(t);J.updateTree(t,Le=>{Le.addNode(B,N,be,Ne.User,void 0,le)}),await a({type:wo.Next,promptId:B,eventMetadata:U,cancelActiveRequests:!0,completionMetadata:te,prependMessages:oe,appendMessages:Se,turnTracker:ae,profiler:Te,...Y?{requestedModelId:Y}:{}})},[t,a]),y=qe(t,B=>B?.tree.getHasErrorFromNode(p)??!1),z=qe(t,B=>B?.tree.isMessageIncomplete(p)??!1),S=!x&&(k||w),F=i.useMemo(()=>S?!1:!y&&z,[y,z,S]),Z=S,$=Ws(t),q=Ae(t),re=mt(q).data,{promptStarters:me,isSuccess:ee}=wn(o&&!$,t,4),xe=Ba(),he=(()=>{if(xe?.messageId===J.getTree(t).getLastValidNode(p)?.message?.id)return xe?.suggestions;if(n&&!$&&ee&&!E)return me})(),De=Wc(),ie=fi(),_e=(()=>{if(re?.gizmo.tags?.includes(Yn.WorkspaceDisabled)&&!ie)return"workspaceDisallowsGizmo";if(De.size){if(b.displayingSideBySideFeedback&&b.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const N=Nt.getConversationMode(t);return N?.kind===Ve.GizmoTest&&N.gizmo_id==null?"noTestGizmoId":null})(),ve=ga(t),je=Vs(t),Ee=In("15117983")?.value,Be=Yi(),Ge=Pn(),Ye=Be.action==="moderate",{value:ne}=Pe("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Ge&&Ye&&ne?e.jsx(Vc,{}):null}),I?e.jsx(qc,{onClose:f}):null,Ee&&je&&je.kind===Ve.PrimaryAssistant&&je.plugin_ids&&je.plugin_ids.length>0?e.jsx(gh,{}):e.jsx(ch,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:W,onAbortCompletion:D,onContinueGenerating:A,currentModelId:s,isNewThread:o,isCompletionInProgress:G,className:"w-full",canContinue:F,suggestions:he??[],disabled:!!_e,disabledReason:_e??void 0,canPause:Z,isInteractableSharedThread:ve,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:h,onAutocompleteSelect:u,headerClassName:m,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:M},t)]})}function gh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(L,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ho=$e({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),fr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${Ra.PromptTextareaHeader}`,children:[e.jsx(mr,{}),e.jsx(hr,{})]})}),Dg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:fr},Symbol.toStringTag,{value:"Module"})),Oo=Oe(()=>Ue(()=>import("./f23thkhb80aspj65.js"),__vite__mapDeps([10,1,2,3,4,5,11,12,13,14,15,16,17])).then(t=>t.SnorlaxSplashScreen)),dn=4;function ph(t){const{layer:s}=et("3533083032"),{layer:o}=Tt("3533083032"),{value:a,isLoading:n}=Pe("3006519778");return n||!a?!1:t?s.get("enable_new_homepage_anon",!1):o.get("enable_new_homepage_anon",!1)}function fh(){const{layer:t}=Tt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=Vn();return!!o&&o.created*1e3>=new Date(s).getTime()}function xh(t){const{layer:s}=et("4031588851"),{layer:o}=Tt("4031588851"),{value:a,isLoading:n}=Pe("633009675");return n||!a?!1:t?s.get("enable_new_autocomplete_homepage",!1):o.get("enable_new_autocomplete_homepage",!1)}const un=t=>`${t.title}${t.body}`.toLocaleLowerCase();function vh(t){const s=Ae(t.clientThreadId),o=ls(s);return e.jsx(ir,{clientThreadId:t.clientThreadId,children:o&&s&&Oo?e.jsx(Oo,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(jh,{...t})})}function Sh({children:t}){const{store:s}=we(),[o,a]=i.useState(!1),n=Js();i.useEffect(()=>n.subscribe("focus",()=>{a(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{a(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&o)}function bh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:o,isSendBlocked:a,clientThreadId:n}){return e.jsxs("div",{className:P(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:P(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(ss,{className:"mb-6 h-12 w-12"})}),s&&(o&&o.length>0?e.jsx(Th,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:o,isSendBlocked:a,clientThreadId:n,isSquare:t}):e.jsx(Zu,{}))]})}function yh({isSendBlocked:t,clientThreadId:s,headlineOption:o,enableNewMobileDesign:a,shouldShowStarterPrompts:n,promptChips:r,onSelectStarterPrompt:l,starterPromptExpanded:c,setStarterPromptExpanded:d}){const h=Ln();return e.jsx(Sh,{children:u=>e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:u?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",u?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary",h?"@lg/thread:hidden":"lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(ss,{className:"inline-block h-12 w-12"}):e.jsx(xr,{headlineOption:o}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!a&&(h?"@lg/thread:hidden":"lg:hidden"),!c&&"h-[116px]"),children:n&&e.jsx(vr,{starterPrompts:r,onSelectStarterPrompt:l,disabled:t,clientThreadId:s,onExpand:()=>d(!0),mobileLayout:!0})})]})})}function wh(t,s,o){const a=Pe("1468311859").value,n=Pe("3664702598").value,{layer:r}=et("4031588851"),l=fh(),c=t||s,d=c&&a,h=c&&n&&l;let u="HARDCODED";if(c)if(o){const m=r.get("search_autocomplete_mode","");d&&m&&(u=m)}else h&&(u=r.get("autocomplete_mode","HARDCODED"));return u}function jh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,v2HomepageDisclaimer:n}){const r=Js(),l=_t(t),c=Ws(t),d=Rn(),[h,u]=i.useState([]),m=i.useCallback(B=>{u(N=>{const U=typeof B=="function"?B(N):B;return la(U,N)?N:U})},[]),{trendingSuggestions:g,fetchTrendingSuggestions:v}=kh(dn),M=i.useRef(!1),{isUnauthenticated:p}=He(),j=xi(),[b,_]=i.useState(!1),C=is(),w=ze();qa(r);const x=Pe("589604007").value,{layer:k}=Tt("4031588851"),{layer:G}=et("4031588851"),{layer:E}=Tt("3533083032"),{layer:H}=et("3533083032"),{promptStarters:I,isSuccess:f}=wn(l&&!c&&o,t,8,x,!0,s??void 0),{promptStarters:A,isSuccess:R,isError:D}=wn(l&&!c&&o,t,4,void 0,void 0,s??void 0),W=j&&!!h.find(B=>!!B.requires_file_upload),y=i.useCallback(B=>{const N=r.getCurrentText();return N&&un(B).startsWith(N.toLocaleLowerCase())},[r]),z=i.useCallback(B=>{const N=r.getCurrentText(),U=B.title+B.body;return y(B)?{...B,title:N,body:U.slice(N.length)}:{...B,title:U,body:""}},[r,y]),S=i.useCallback((B=!1)=>{m(N=>!N.some(y)&&N.length>0?[]:B?N:N.map(z))},[y,z,m]),F=(B,N,U)=>{const te=B.title;m([]),r.focus(),r.setText(te),requestAnimationFrame(()=>{const le=(I?.filter(oe=>oe.theme===B.theme)??[]).map(oe=>{const Se=Mt(oe.oneliner),ae=Se.startsWith(oe.title);return{...oe,title:ae?`${oe.title} `:"",body:ae?oe.body:Se,autocompletionChunks:Ym(te,Se),type:Hs.Autocomplete}});m(le),le.length>0&&Et(le,t),Qc(B,U,t)})};i.useEffect(()=>{const B=h.some(N=>N.theme===jn.Search);C&&r.getCurrentText()===""?g.length>0?m(g):v():B&&!C&&m(N=>N.filter(U=>U.theme!==jn.Search))},[h,C,g,v,r,m]);const Z=I?.reduce((B,N)=>(N.theme&&!B[N.theme]&&(B[N.theme]=N),B),{}),$=[];if(Z)for(const B in Z)$.push(Z[B]);const q=$&&$.length>0,re=!!(f&&q&&o),me=!!((R||D)&&o),ee=dn-h.filter(y).length,xe=p?H.get("enable_new_mobile",!1):G.get("enable_new_mobile",!1),he=wh(xe,j,C),De=p?E.get("headline_option","HELP_WITH"):k.get("headline_option","HELP_WITH"),ie=k.get("autocomplete_min_char",4),_e=k.get("autocomplete_fetch_interval",200),ve=i.useRef(null),je=i.useCallback($a(async B=>{const N=r.getCurrentText();if(!N||N.length<ie||N.length>80||r.hasMultipleLines()){m([]);return}if(!M.current&&!(ve.current&&ve.current.length>ie&&N.startsWith(ve.current)))try{const U=await At.generateAutocompletions(N,B,C);if(U.completions.length===0){ve.current=N;return}const te=U.completions.map(le=>({id:Ki(),type:Hs.Autocomplete,title:le.slice(0,N.length),body:le.slice(N.length),oneliner:le,prompt:le,source:he})).filter(y).map(z);m(le=>{const oe=le.filter(y),Se=te.filter(ae=>{const Te=un(ae);return!oe.some(Y=>{const be=un(Y);if(Te===be)return!0;const Le=/[\p{P}\p{S}]$/u,ge=Te.replace(Le,""),ht=be.replace(Le,"");return ge===be||Te===ht||ge===ht})}).slice(0,dn-oe.length);return[...oe,...Se]}),te.length>0&&Et(te,t)}catch{}},he==="BING"?150:_e),[r,he,z,_e]),Ee=i.useCallback(()=>{S(),ee>0&&je(ee)},[je,S,ee]);i.useEffect(()=>{M.current&&m([])},[M,m]);const Be=i.useMemo(()=>he==="HARDCODED"?S:Ee,[he,Ee,S]),Ge=i.useCallback(()=>{r instanceof Zn&&S(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,S]),Ye=i.useCallback((B,N,U)=>{N.forEach(te=>{te.id===B.id&&(te.userInput=r.getCurrentText())}),m([N[U]])},[r,m]),ne=Ln();return e.jsx(e.Fragment,{children:e.jsx(as,{children:e.jsx("div",{className:P("h-full w-full",ne?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Kn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Ro,{children:[e.jsx("div",{className:P("mb-7 hidden text-center",ne?"@lg/thread:block":"lg:block"),children:De==="CHATGPT_LOGO"?e.jsx(ss,{className:"inline-block h-12 w-12"}):e.jsx(xr,{headlineOption:De})}),!xe&&e.jsx(bh,{isUnauthenticated:p,shouldShowLegacyStarterPrompts:me,legacyPromptStarters:A,isSendBlocked:d,clientThreadId:t}),xe&&e.jsx(yh,{headlineOption:De,enableNewMobileDesign:xe,shouldShowStarterPrompts:re,promptChips:$,onSelectStarterPrompt:F,starterPromptExpanded:b,setStarterPromptExpanded:_,isSendBlocked:d,clientThreadId:t}),e.jsx("div",{className:P(ne?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ro,{children:w?e.jsx(fr,{}):e.jsx(ur,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(pr,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:a,showPromptStarters:!1,autocompletions:h,requiresFileUpload:W,onComposerInput:Be,onComposerChange:Ge,onAutocompleteSelect:Ye,onTaggingDropdownClose:()=>{M.current=!1},onTaggingDropdownOpen:()=>{M.current=!0},hideHeader:!0})}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden",ne?"@lg/thread:block":"lg:block",n&&p&&b?"":"h-[70px]"),children:re&&e.jsx(vr,{starterPrompts:$,onSelectStarterPrompt:F,disabled:d,clientThreadId:t,onExpand:()=>_(!0)})}),n&&e.jsx("div",{className:P("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",ne?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:P("min-h-4",w&&"keyboard-open:hidden"),children:n})})]})})})})})}function xr({headlineOption:t}){const o=Ce().formatMessage(Nh[t]||Qt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:o})})}function Mh({starterPrompt:t,starterPrompts:s,index:o,disabled:a,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=$s(),{mutate:c}=Zc(),d=t.category==="onboarding"?()=>{c({key:ct.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>n(t,s,o);return e.jsx(Ya,{disabled:a,onClick:d,icon:e.jsx(ed,{category:t.category,useV2Colors:!0}),label:r})}function Uo({clientThreadId:t,onClick:s}){i.useEffect(()=>{td(t)},[t]);const o=Ce();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Ya,{onClick:()=>{sd(t),s()},label:o.formatMessage(Qt.moreStarterPrompts)})})}const Ch=5,_h=3;function vr({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:a,onExpand:n,mobileLayout:r=!1}){const l=r?_h:Ch,[c,d]=i.useState(l),[h,u]=i.useState(!1),m=i.useRef(null),g=t.length<=c;i.useEffect(()=>{Et(t.slice(0,l),a)},[a]),i.useEffect(()=>{if(!h&&!g&&m.current){const M=m.current,p=M.getBoundingClientRect(),j=p.width,b=Array.from(M.children);let _=0;for(let C=0;C<b.length&&b[C].getBoundingClientRect().right-p.left<=j;C++)_++;d(_),u(!0)}},[t,g,h]);const v=()=>{const M=t.slice(c,t.length).map(p=>({...p,isAdditional:!0}));M.length>0&&Et(M,a),d(t.length),n()};return e.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",h&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:m,children:[t.slice(0,c).map((M,p)=>e.jsx(se.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Mh,{starterPrompt:M,starterPrompts:t,index:p,disabled:o,onSelectStarterPrompt:s})},M.id??p)),r&&t.length>c&&e.jsx(Uo,{clientThreadId:a,onClick:v})]}),!r&&t.length>c&&e.jsx(Uo,{clientThreadId:a,onClick:v})]})}function Th({promptStarters:t,isSendBlocked:s,clientThreadId:o,isSquare:a,...n}){i.useEffect(()=>{Et(t,o)},[o]);const r=$s(),l=Ln();return e.jsx(e.Fragment,{children:a?e.jsx(se.div,{...n,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx(es,{children:e.jsx(lr,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(se.div,{...n,className:"flex-shrink overflow-y-hidden",children:e.jsx(em,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:P("mt-6",l?"@lg/thread:mt-12":"lg:mt-12")})})})}const kh=t=>{const[s,o]=i.useState([]),a=i.useCallback(async()=>{const r=(await At.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:Hs.Starter,title:zo(l),body:"",icon:e.jsx(Xc,{}),prompt:zo(l),id:`starter-${c}`,theme:jn.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function zo(t){return t.split(" ").map(Jc).join(" ")}const Qt=$e({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Nh={HELP_WITH:Qt.whatCanIHelpWith,WHERE_TO_START:Qt.whereShouldWeStart,ASK_CHATGPT:Qt.askChatgptAnything};function Sr({clientThreadId:t,currentLeafId:s}){const{currentModelId:o}=eo(),a=Ys(t),n=pa(t,s),r=Ae(t),l=ut(),c=Xn(o),d=_t(t)&&!n&&(Ps(a)||a?.kind===Ve.GizmoTest),h=ls(r);return{showEmptyState:d,canUseNewHomepage:d&&h||d&&!r&&!c&&!l}}const Go=fe.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Ah({conversation:t,gizmoResource:s,elementRef:o}){const a=wi(t.id)??t.title;return e.jsx(vn,{to:id(t.id,s),children:e.jsx(Q.Item,{icon:ld,children:e.jsx("div",{ref:o,children:a})},t.id)})}function Eh({gizmoId:t,clientThreadId:s,inMobileHeader:o,modelLabel:a,modelPickerContent:n}){const r=Ce(),{data:l}=mt(t),{items:c,hasNextPage:d,fetchNextPage:h,isLoading:u,isFetchingNextPage:m}=nd(t),g=i.useRef(null),v=i.useCallback(A=>{u||A==null||(g.current?.disconnect(),g.current=new IntersectionObserver(R=>{R[0].isIntersecting&&d&&h()}),g.current.observe(A))},[u,d,h]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const{title:M,titleSource:p}=vi(s),j=ze(),{conversationLeafId:b}=eo(),{showEmptyState:_}=Sr({clientThreadId:s,currentLeafId:b}),C=Ws(s),w=od(),x=r.formatMessage(bn.newChatTitle),{resolvedTitle:k,isTypingEffect:G}=ad(s,M??null,!0),{value:E}=Pe("1856506891");if(!l||_)return null;const H=k==null&&(_t(s)||p===Si.NewChat),I=C?e.jsx(e.Fragment,{}):e.jsxs(Go,{$isScreenArch:j,$shimmer:H,children:[e.jsxs("div",{className:"truncate",children:[G?e.jsx(cd,{text:k??""}):k??x,E&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:a})]}),e.jsx(Jn,{className:"icon-md text-token-text-tertiary"})]}),f=w&&l.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[l.gizmo.display.emoji," ",l.gizmo.display.name]}):l.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Go,{$isScreenArch:j,children:e.jsx(vn,{className:"truncate",to:Io(l),children:f})}),e.jsxs(e.Fragment,{children:[e.jsx(bi,{className:"icon-md text-token-text-tertiary"}),e.jsxs(fa,{contentAlign:o?"center":"start",size:"small",triggerButton:I,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[E&&e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(L,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:a})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{children:n})})]}),e.jsx(vn,{to:Io(l),children:e.jsx(Q.Item,{icon:rd,children:e.jsx(L,{...bn.newChatProjectDropdownItem,values:{name:`"${l.gizmo.display.name}"`}})},"new-chat")}),c.filter(A=>A.id!==s).map((A,R)=>{const D=d&&R===c.length-4?v:void 0;return e.jsx(Ah,{elementRef:D,conversation:A,gizmoResource:l},A.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(yi,{})})]})]})]})}const Rh=Oe(()=>Ue(()=>import("./bwqwq4vziwiutfyf.js"),__vite__mapDeps([18,3,1,4,2,5,19])).then(t=>t.ThreadHeaderGizmoDropdown)),Nn=fe.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] px-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Ih({clientThreadId:t}){const s=Ce(),o=ut(),a=ji(t),n=On(),[,r]=ba(),l=()=>{!a&&!o?n({pathname:"/",search:new URLSearchParams({[Cs]:"true"}).toString()}):r(c=>(c.get(Cs)==="true"?c.delete(Cs):c.set(Cs,"true"),c),{replace:a,state:wd()})};return e.jsx(Q.Item,{size:"large",className:"!pr-3",onClick:l,icon:fd,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(L,{...wr.temporaryChat})}),e.jsx(xd,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function Ph(t){return t.title?t.title:t.shortLabel}function ao(t,s,o){let a=t;if(t===Mo.AUTO){const l=s.filter(({defaultModel:c})=>c!==Mo.AUTO);l.length===1&&(a=l[0].defaultModel)}const n=s.find(({defaultModel:l})=>l===a);if(n){const{categoryId:l}=n,c=Ph(n);return{selectedCategory:l,modelLabel:c,omitPrefix:!!n.title}}const r=o.find(({modelIds:l})=>l.includes(a));if(r){const{group:l,shortLabel:c}=r;return{selectedCategory:l,modelLabel:c}}return{selectedCategory:null,modelLabel:null}}function Dh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function Bh({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,categories:a,groups:n}=Xs(),r=Mi(),c=rs(t).id,d=Ka(),{modelLabel:h,omitPrefix:u}=ao(c,a,n),m=br(t,d),g=Ce(),{isUnauthenticated:v}=He(),M=!v&&!r;i.useEffect(()=>{o||vd({namespace:Va.ChatPageLoad})?.logTiming("render_model_switcher")},[o]);const p=ze(),j=e.jsxs("div",{className:P(p?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[u?null:`${Xa} `,M?e.jsx("span",{className:"text-token-text-secondary",children:h}):v&&h?e.jsx(Dh,{modelLabel:h}):null]});return m.length?o?null:e.jsx(fa,{sideOffset:8,size:"large",triggerButton:e.jsxs(Nn,{$isScreenArch:p,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":h?g.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:h}):"",children:[j,p?e.jsx(Sd,{className:"icon-md text-token-text-tertiary"}):e.jsx(Jn,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:b=>{K.logEvent(X.toggleModelSwitcher,{isOpen:b}),ue.logEvent("toggle_model_switcher",null,{isOpen:String(b)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(yr,{sections:m})}):e.jsx(Nn,{className:"cursor-default",children:j})}function Lh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:a,omitIcon:n,testId:r}){const{defaultModel:l,label:c,categoryId:d,description:h,isBeta:u}=t,m=bd(o??"");return e.jsx(Mn,{value:l,currentModelId:a,modelSwitcherDenialsBySlug:s,renderName:g=>e.jsx(An,{categoryId:d,name:c,description:h,isDisabled:g,omitIcon:n,isBeta:u}),isSelected:(!o||m)&&a===l,testId:r},l)}function br(t,s){const o=rs(t),a=o.id,n=Ae(t),{categories:r,groups:l}=Xs(),{doesUserHaveAnyAccountsWithPlusFeatures:c}=Fn(),d=J.getServerThreadId(t),h=ud({clientThreadId:t}),u=Ce(),m=!d,{isUnauthenticated:g}=He(),v=md(),{layer:M}=et("2723963139"),p=M.get("is_dynamic_model_enabled",!1),j=s.find(({categoryId:y})=>y===Je.ALPHA),b=s.find(({categoryId:y})=>y===Je.DATA_CAMPAIGNS),_=s.find(({categoryId:y})=>y===Je.EXPERIMENTS),C=s.find(({categoryId:y})=>y===Je.MAINLINE),w=!0,x=!!j?.options?.length,k=!!b?.options?.length,G=!!_?.options?.length,E=!!C?.options?.length,H=On(),I=i.useCallback(()=>{K.logEvent(X.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),hd(H,"Thread header dropdown")},[H]),f=()=>{ue.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),K.logEvent(X.modelSwitcherPlusUpgradeButtonClicked),g?v({shouldOpenPaymentModalOnAuth:!0,callback:y=>{K.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:y})}}):I()},A=[],R=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(L,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:p?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(Ia,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(g){const y={id:"modelSection",content:[]};y.content.push(e.jsx(gd,{},"noAuthUpsell")),A.push(y)}else if(!c&&!n){const y={id:"modelSection",content:[]};y.content.push(e.jsx(Mn,{value:"",currentModelId:a,onClick:f,modelSwitcherDenialsBySlug:h,isUpgradeUpsell:!0,renderName:z=>e.jsx(An,{icon:yd,isDisabled:z,name:u.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:u.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),y.content.push(e.jsx(Mn,{value:cn.AUTO,currentModelId:a,modelSwitcherDenialsBySlug:h,renderName:z=>e.jsx(An,{icon:pd,name:u.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:u.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:z,omitIcon:!1}),isSelected:!n&&a===cn.AUTO,showNewChatHint:!0},cn.AUTO)),A.push(y)}else{const y={id:"modelSection",content:[]};r.length&&y.content.push(R);const z=new Map;r.forEach(S=>{const F=e.jsx(Lh,{category:S,currentGizmoId:n,currentModelId:a,modelSwitcherDenialsBySlug:h,omitIcon:w,testId:`model-switcher-${S.defaultModel}`},S.categoryId);S.subcategory?(z.has(S.subcategory)||z.set(S.subcategory,[]),z.get(S.subcategory)?.push(F)):y.content.push(F)}),z.forEach((S,F)=>{const Z=r.find($=>$.subcategory===F&&$.defaultModel===o.id);y.content.push(e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{"data-testid":F==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[F,!!Z&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:Z.label})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-72",children:S})})]},F))}),A.push(y)}const D={id:"otherOptionsSection",content:[]},{selectedCategory:W}=ao(a,r,l);return m&&(x&&D.content.push(e.jsx(Ms,{isSelected:W===Je.ALPHA,currentModel:o,option:j,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),k&&D.content.push(e.jsx(Ms,{isSelected:W===Je.DATA_CAMPAIGNS,currentModel:o,option:b,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},b.value)),G&&D.content.push(e.jsx(Ms,{currentModel:o,isSelected:W===Je.EXPERIMENTS,option:_,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},_.value)),E&&D.content.push(e.jsx(Ms,{isSelected:W===Je.MAINLINE,currentModel:o,option:C,modelSwitcherDenialsBySlug:h,displayInFull_INTERNAL_USE_ONLY:!0},C.value))),D.content.length&&A.push(D),!g&&!n&&A.push({id:"temporaryChatSection",content:[e.jsx(Ih,{clientThreadId:t},"tempChat")]}),A}function Fh(){const t=Ce();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(wr.beta)})}function An({isDisabled:t,name:s,icon:o,categoryId:a,description:n,extra:r,omitIcon:l,isBeta:c=!1}){let d=s;return c&&(d=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(Fh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!l&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:o?e.jsx(o,{className:"h-4 w-4 text-token-text-primary"}):a&&e.jsx(Ja,{type:"filled",className:P("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:a})}),e.jsxs("div",{children:[d,e.jsxs("div",{className:P(!t&&"text-token-text-secondary","text-xs"),children:[n,r]})]})]})}function yr({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(wa.Fragment,{children:[o!==0?e.jsx(Q.Separator,{}):null,s.content]},s.id))})}function Hh({clientThreadId:t,inMobileHeader:s=!1}){const o=Ae(t),a=ls(o),{conversationLeafId:n}=eo(),{showEmptyState:r}=Sr({clientThreadId:t,currentLeafId:n}),{value:l}=Pe("408434742"),{value:c}=Pe("3463955812"),{data:d}=mt(o),h=ze(),{categories:u,groups:m}=Xs(),v=rs(t).id,{modelLabel:M}=ao(v,u,m),p=Ka(),j=br(t,p),b=e.jsx(Bh,{clientThreadId:t,inMobileHeader:s});return o==null?b:a?r&&l&&d?c||dd(d)?b:e.jsx("div",{className:"inline-block",children:e.jsx(ns,{label:e.jsx(L,{id:"u2Bz6Y",defaultMessage:"When using custom instructions or files, only GPT-4o is available"}),side:"right",children:e.jsxs(Nn,{$isScreenArch:h,disabled:!0,children:[Xa," ","4o"]})})}):e.jsx(Eh,{modelLabel:M??"",modelPickerContent:e.jsx(yr,{sections:j}),gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(Rh,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const wr=$e({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Oh=Oe(()=>Ue(()=>import("./l7zuelk7pxni1h8r.js"),__vite__mapDeps([20,1,3,4,21,22,2,5,23,24,25,26,27,28,29,13,30,31,32,33,34,35,14,19,36,37,38,39])).then(t=>t.GizmoUsingAsOwnerNotice)),Uh=({clientThreadId:t})=>{const s=$n(g=>g.activeStageSidebar),o=J.getServerThreadId(t),a=jd(Is.WorkspaceShareLinks),{isUnauthenticated:n}=He(),r=ut(),l=Ae(t),c=ls(l),d=a&&o&&!n&&!r&&!c,h=ze(),u=Ci(),m=!s&&!(!n&&h&&u.get("include_account_settings_move",!1));return e.jsx("div",{className:P(!h&&"gap-2",h&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(Ju,{showShareButton:d,showProfileDropdown:m,clientThreadId:t})})};function zh({clientThreadId:t,gizmoId:s}){const o=Md(),{data:a}=mt(s),n=Gs();return e.jsxs(e.Fragment,{children:[e.jsxs(Cd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[a!=null&&n?.isWorkspaceAccount()&&a.gizmo.tags?.includes(Yn.WorkspaceDisabled)&&e.jsx(Oh,{gizmo:a}),e.jsx(_d,{gizmoId:s,clientThreadId:t})]}),e.jsx(Td,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Qu,{clientThreadId:t}),e.jsx(Hh,{clientThreadId:t})]})}),e.jsx(Uh,{clientThreadId:t})]}),o&&e.jsx(kd,{})]})}function jr({clientThreadId:t}){const s=Ae(t),o=Dn(),a=ze();return o||a?null:e.jsx(zh,{gizmoId:s,clientThreadId:t})}function Gh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r}){const l=ut();let c=e.jsx(sm,{}),d;return l?(d=e.jsx(Wh,{}),c=e.jsx(ss,{className:"mb-6 h-12 w-12"})):t!=null?(d=n?e.jsx(vh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,v2HomepageDisclaimer:r}):e.jsx(nm,{clientThreadId:t}),c=null):d=e.jsx(Vh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,d]})}function Wh({gizmo:t}){const s=Ad(),o=t?Ed(t.tools):!1,a=Gs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Rd,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(L,{...it.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(L,{...a?.isWorkspaceAccount()?s?it.temporaryChatBizMemoryAvailable:it.temporaryChatBizMemoryUnavailable:s?it.temporaryChatDescriptionMemoryAvailable:it.temporaryChatDescriptionMemoryUnavailable}),o&&e.jsx("div",{className:"mt-3",children:e.jsx(L,{...it.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function Vh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(L,{...it.howCanIHelpYouToday})})}function qh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r}){const l=Ae(t),c=_i(),d=Rn(),{data:h}=mt(l),u=Nd(),m=Ti(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&h==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(jr,{clientThreadId:t})}),h!=null?e.jsx(tm,{gizmo:h,showStarterPrompts:!0,disableStarterPrompts:d}):e.jsx(Gh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:a,enableV2Homepage:n,v2HomepageDisclaimer:r})]})}const it=$e({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function $h({className:t,clientThreadId:s,message:o,onModelSelect:a,onDropdownChange:n}){const r=Ce(),[l,c]=i.useState(null),[d,h]=i.useState(!1),[u,m]=i.useState(!1),g=Id(),v=Qa(s),M=Ae(s),p=Za({clientThreadId:s,message:o}),j=o.message.metadata?.model_slug,{modelOptions:b,modelSlug:_,animateModelLabelOnRender:C,nuxProps:w,messageModelEnabledTools:x}=p,k=er(o.message),G=x.includes(It.Search),E=i.useMemo(()=>b.find(y=>y.value==j),[b,j]),{doesUserHaveAnyAccountsWithPlusFeatures:H}=Fn(),I=i.useRef(null),f=y=>{y||setTimeout(()=>{I.current&&I.current.blur()},10)};if(i.useEffect(()=>{f(d)},[d]),!g||M)return null;const A=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Wo.search),icon:e.jsx(Un,{className:"icon-sm"}),condition:G&&!k,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Wo.nosearch),icon:e.jsx(tr,{className:"icon-sm"}),condition:G&&k,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let R,D;w.shouldRenderNux?(R=Kh,D={title:e.jsx(L,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(L,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:w.usedModelName,largestModelName:w.largestModelName}}),markAsViewed:w.announcement.markAsViewed}):(R=Yh,D={label:v?e.jsx(L,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(L,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:w.usedModelName}})});const W=v&&b.some(y=>ts(y,H));return e.jsxs(Q.Root,{onOpenChange:y=>{v&&(h(y),n(y),f(y)),y&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:W})},children:[e.jsx(R,{...D,children:e.jsx(En,{ref:I,className:P("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Mr,{modelSlug:_,animateModelLabelOnRender:C,isDropdownOpen:d,isRegenerateEnabled:v,isHovered:u})})}),v&&e.jsxs(Q.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[b.map(y=>{const z=ts(y,H),{value:S,...F}=y;return e.jsx(Ct,{value:S,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",S,{requestedModelId:S,...Ze({clientThreadId:s})}),a({requestedModelId:S})},onMouseEnter:()=>c(S),onMouseLeave:()=>c(null),isHovered:l===S,messageModelSlug:o.message.metadata?.model_slug,shouldShowUpsell:z,...F},S)}),!!E&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),A.filter(y=>y.condition).map(y=>e.jsx(Ct,{onSelect:()=>{ue.logEvent(y.eventName,E.value,{requestedModelId:E.value,...Ze({clientThreadId:s})}),a({requestedModelId:E.value,extraStreamParams:y.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>c(y.key),onMouseLeave:()=>c(null),isHovered:l===y.key,messageModelSlug:j,includeCheck:!1,...E,label:y.label,subtitle:"",icon:y.icon},y.key))]})]})]})}function Mr({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:a,isHovered:n,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[d,h]=i.useState("initial"),{categories:u}=Xs({isRegen:!!r});i.useEffect(()=>{if(s){const b=setTimeout(()=>h("show"),500),_=setTimeout(()=>h("initial"),2e3);return()=>{clearTimeout(b),clearTimeout(_)}}h("initial")},[s]);const m=u.find(({defaultModel:b})=>b===t),g=t===Pd?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:v,shorterLabel:M}=m??g,p={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},j=o?"visible":n?"show":d;return e.jsxs(se.div,{initial:"initial",animate:j,className:"flex items-center pb-0",children:[!c&&(r?e.jsx(Qn,{className:"icon-md"}):v&&e.jsx(Ja,{type:"outline",categoryId:v,className:"icon-md h-4 w-4"})),(a||l)&&e.jsx(se.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:p,transition:{type:"tween",duration:.18},children:M}),a&&e.jsx(Jn,{className:P("icon-sm",{"text-token-text-quaternary":!n&&!r},{"text-token-text-secondary":n&&!r})})]})}function Yh({children:t,label:s}){return e.jsx(ns,{label:s,sideOffset:0,children:t})}function Kh({children:t,title:s,description:o,markAsViewed:a}){return e.jsx(Gn,{announcementKey:ct.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:o,badge:"beta",onDismiss:a,dismissOnOutsideClick:!0,children:t})}function ts(t,s){const{modelSwitcherDeny:o,subscriptionLevel:a}=t;return!!o&&o.reason===ki.RATE_LIMIT&&a===Ni.PLUS&&!s}const Wo=$e({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Xh=i.memo($h),Es="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Jh({className:t,clientThreadId:s,message:o,onModelSelect:a,onDropdownChange:n,canRegenerateResponse:r}){const[c,d]=i.useState(null),[h,u]=i.useState(!1),[m,g]=i.useState(!1),v=Ae(s),M=Za({clientThreadId:s,message:o}),p=o.message.metadata?.model_slug,j=o.message.id,{modelOptions:b,modelSlug:_,animateModelLabelOnRender:C,messageModelEnabledTools:w}=M,x=er(o.message),k=w.includes(It.Search),G=i.useMemo(()=>b.find(R=>R.value===p),[b,p]),E=i.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:H}=Fn(),I=R=>{R||setTimeout(()=>{E.current&&E.current.blur()},10)};if(i.useEffect(()=>{I(h)},[h]),Ai(s))return null;const A=r&&b.some(R=>ts(R,H));return v?null:e.jsxs(Q.Root,{onOpenChange:R=>{r&&(u(R),n(R),I(R)),R&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:A,is_new_regen_dropdown:!0})},children:[r?e.jsx(Zh,{label:e.jsx(L,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(En,{ref:E,className:P("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Mr,{modelSlug:_,animateModelLabelOnRender:C,isDropdownOpen:h,isRegenerateEnabled:r,isHovered:m,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Q.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(L,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Qh,{clientThreadId:s,messageId:j,onModelSelect:a,messageModelSlug:p,omitModelIcons:!0,modelOptions:b,setHoveredOption:d,hoveredOption:c,retryOption:G,lastResponseUsedSearch:x,modelSupportsSearch:k,doesUserHaveAnyAccountsWithPlusFeatures:H})]})})]})}function Qh({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:a,onModelSelect:n,omitModelIcons:r,setHoveredOption:l,hoveredOption:c,retryOption:d,lastResponseUsedSearch:h,modelSupportsSearch:u,doesUserHaveAnyAccountsWithPlusFeatures:m}){const g=Ce(),[v,M]=i.useMemo(()=>Dd(o,C=>C.subcategory),[o]),p=i.useMemo(()=>{const C=new Map;return v.forEach(w=>{const x=w.subcategory;x&&(C.has(x)||C.set(x,[]),C.get(x)?.push(w))}),C},[v]),j=P("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),b=r?"right":"left",_=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(mn.search),icon:e.jsx(Un,{className:j}),condition:u&&!h,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(mn.nosearch),icon:e.jsx(tr,{className:j}),condition:u&&h,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[M.map(C=>{const{value:w,...x}=C;return e.jsx(Ct,{value:w,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...Ze({clientThreadId:t,messageId:s})}),n({requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>l(w),onMouseLeave:()=>l(null),isHovered:c===w,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:ts(C,m),className:Es,...x,icon:r?e.jsx("span",{className:j}):x.icon,justifyIcon:b,wrapIcon:!r},w)}),[...p.entries()].map(([C,w])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:C})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:w.map(x=>{const{value:k,...G}=x;return e.jsx(Ct,{value:k,onSelect:()=>{ue.logEvent("chatgpt_regenerate_switch_model_button_clicked",k,{requestedModelId:k,...Ze({clientThreadId:t,messageId:s})}),n({requestedModelId:k})},includeRegenerate:!1,onMouseEnter:()=>l(k),onMouseLeave:()=>l(null),isHovered:c===k,messageModelSlug:a,includeCheck:!1,className:Es,...G,icon:null,justifyIcon:b,wrapIcon:!r,shouldShowUpsell:ts(x,m)},C+"-"+k)})})})]},C)),!!d&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(Ct,{onSelect:()=>{ue.logEvent("chatgpt_regenerate_try_again_button_clicked",d.value,{requestedModelId:d.value,...Ze({clientThreadId:t,messageId:s})}),n({requestedModelId:d.value})},includeRegenerate:!0,onMouseEnter:()=>l(d.value),onMouseLeave:()=>l(null),messageModelSlug:a,includeCheck:!1,className:Es,...d,label:g.formatMessage(mn.tryAgain),subtitle:d.label,icon:e.jsx(Qn,{className:j}),justifyIcon:b,wrapIcon:!r},d.value),_.filter(C=>C.condition).map(C=>e.jsx(Ct,{onSelect:()=>{ue.logEvent(C.eventName,d.value,{requestedModelId:d.value,...Ze({clientThreadId:t,messageId:s})}),n({requestedModelId:d.value,extraStreamParams:C.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>l(C.key),onMouseLeave:()=>l(null),isHovered:c===C.key,messageModelSlug:a,includeCheck:!1,className:Es,...d,label:C.label,subtitle:"",icon:C.icon,justifyIcon:b,wrapIcon:!r},C.key))]})]})}function Zh({children:t,label:s}){return e.jsx(ns,{label:s,sideOffset:0,children:t})}const mn=$e({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),eg=i.memo(Jh),Vo=Oe(()=>Ue(()=>import("./lt2ef0v2naysiy2l.js").then(t=>t.qT),__vite__mapDeps([2,3,1,4,5])).then(t=>t.MemoryActionResult));function qo(t,s,o){J.updateTree(t,a=>{a.updateNodeMetadata(s,{inlineComparisonRating:o})})}function $o(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Yo=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function tg(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Cr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(sg,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function sg(t){const{clientThreadId:s,variantIds:o,variantsInStreamInfo:a,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=ro(),c=og(),d=Bn(),h=Ei(),[u,m]=i.useMemo(()=>sr(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),g=u<m?"left":"right",v=g==="left"?"right":"left",M=o[u],p=o[m],j=Mt(qe(s,I=>I?.tree.getLeafFromNode(M))).id,b=Mt(qe(s,I=>I?.tree.getLeafFromNode(p))).id,_=Mt(xn(s,n,j)),C=Mt(xn(s,n,b)),w=g==="left"?_:C,x=g==="left"?C:_,k=a.display_treatment==="unskippable",G=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(yn.setState({displayingSideBySideFeedback:!0,unskippable:k}),()=>{yn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[k]),Bd();const E=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Ri(Ii,{requestCompletion:()=>{const I=Qe(w.messages)?.completionSampleFinishTime,f=Qe(x.messages)?.completionSampleFinishTime,A=J.getServerThreadId(s);if(c){const D=J.getTree(s).getParentPromptNode(j),W=[_,C].map((S,F)=>({messageId:S.messages[S.messages.length-1].message.id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:Qe(S.messages)?.completionSampleFinishTime})),y={},z=D.metadata?.variantsInStreamInfo==null&&D.message.metadata?.paragen_variants_info!=null;for(const S of W)y[S.messageId]=z?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:S.loadFirstTokenTime,load_end_time:S.loadEndTime};Rs({shouldUseNewParagenEndpoint:c,params:{conversation_id:A,displayed_message_ids:W.map(S=>S.messageId),message_metadatas:y,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:D.message.id}})}else Rs({shouldUseNewParagenEndpoint:c,params:{feedback_version:G,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:x.messages[x.messages.length-1]?.message.id,conversation_id:A,completion_comparison_rating:"skip",new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:I??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:f??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:$o(h),...E.current}})}}),[_,C,j,s,t.conversationTurnMountTime,G,v,w?.messages,x?.messages,h,c,l,r]);const H=I=>{const A=J.getTree(s).getLeafFromNode(I);J.setThreadCurrentLeafId(s,A.id);const R=I===M,D=R===(g==="left"),W=Qe(w.messages)?.completionSampleFinishTime,y=Qe(x.messages)?.completionSampleFinishTime;w.messages.length>0&&qo(s,w.messages[w.messages.length-1].nodeId,D?"original":"new"),x.messages.length>0&&qo(s,x.messages[x.messages.length-1].nodeId,D?"original":"new");let z;W==null||y==null?z=D?"partial_load_comparison_original":"partial_load_comparison_new":z=D?"original":"new";const S=J.getServerThreadId(s);if(c){const F=[_,C].map((ee,xe)=>({messageId:ee.messages[ee.messages.length-1].message.id,loadFirstTokenTime:xe===0?r.current.left:r.current.right,loadEndTime:Qe(ee.messages)?.completionSampleFinishTime})),Z=R?F[0].messageId:F[1].messageId,q=J.getTree(s).getParentPromptNode(j),re={},me=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const ee of F)re[ee.messageId]=me?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:ee.loadFirstTokenTime,load_end_time:ee.loadEndTime};Rs({shouldUseNewParagenEndpoint:c,params:{conversation_id:S,displayed_message_ids:F.map(ee=>ee.messageId),message_metadatas:re,rating:"selected",selected_message_id:Z,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:q.message.id}})}else Rs({shouldUseNewParagenEndpoint:c,params:{feedback_version:G,original_message_id:w.messages[w.messages.length-1]?.message.id,new_message_id:x.messages[x.messages.length-1]?.message.id,conversation_id:S,completion_comparison_rating:z,new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:W??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:y??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:$o(h),...E.current}})};return e.jsx(Cr,{...t,setPreferredFeedback:H,leftVariantId:M,rightVariantId:p,leftTurn:_,rightTurn:C,hasActiveRequest:d,originalTurn:w,visibilityStateRef:E})}function ng(t){if(!t.length)return!1;const s=t.filter(o=>o.type===Po.Text||o.type===Po.MultiText).filter(o=>o.message.message.status!=="finished_successfully"&&o.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(o=>{const a=o.message.message.content;return a?.content_type===Ls.Text&&a.parts.join("")===""})}function Cr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:a,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:h,shouldShowParagenLabels:u=!1}=Na(),m=a&&Yo(a)||h,g=n&&Yo(n)||h,v=i.useMemo(()=>a?.messages??[],[a?.messages]),M=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:p,firstVisibleTokenTimestampsRef:j}=d,b=i.useMemo(()=>Us(v),[v]),_=i.useMemo(()=>Us(M),[M]),C=_a(),[w,x]=i.useMemo(()=>[b,_].map(F=>ng(F)),[b,_]),k=lt(a?Bs.getRequestIdFromConversationTurn(a):"")||w,G=lt(n?Bs.getRequestIdFromConversationTurn(n):"")||x,E=a?.role===Ne.User,H=n?.role===Ne.User,I=i.useRef(null),f=i.useRef(null),A=i.useRef(null),R=d.stubSideBySideFeedback||w,D=d.stubSideBySideFeedback||x;!R&&j.current.left==null&&(j.current.left=Date.now()),!D&&j.current.right==null&&(j.current.right=Date.now()),i.useEffect(()=>{if(I.current&&f.current&&A.current){const F=Array(11).fill(0).map(($,q)=>q/10),Z=new IntersectionObserver($=>$.forEach(q=>{q.target===f.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=q.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,q.intersectionRatio)):q.target===A.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=q.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,q.intersectionRatio))}),{root:I.current,threshold:F});return Z.observe(f.current),Z.observe(A.current),()=>Z.disconnect()}},[c]);const{data:W}=Ta(void 0,!1,C),y=ro(),z=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(L,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),S=ze();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",S&&"top-[var(--thread-leading-height)] pt-3",!S&&"top-[-1px]",y&&!S?"md:top-header-height":S?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(L,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),y?z:null]}),y?null:z,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:I,children:e.jsx("div",{className:P(!S&&"min-w-fit"),children:e.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",y&&!S&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!y&&!S&&"gap-4 sm:gap-6",y&&S&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",S&&!y&&"gap-4 sm:gap-6"),children:[e.jsxs(Ko,{horizontalScrollContainerRef:I,rootElementRef:f,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Qo,{children:[e.jsx(Cn,{messages:v,isUserTurn:E,avatarClassName:p}),e.jsx(Jo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(L,{...ea.responseNumber,values:{responseIndex:1}})})]}),y&&R?e.jsx(Xo,{}):e.jsxs(e.Fragment,{children:[W!=null&&!E&&e.jsx(Vo,{clientThreadId:d.clientThreadId,messages:v,isParagen:!0}),e.jsx(_n,{...d,groupedMessagesToRender:b,allGroupedMessages:b,isEditing:!1,isUserTurn:E,isCompletionRequestInProgress:k,hasActiveRequest:r,handleEnterEdit:js,handleExitEdit:js,shouldGrowContainer:!1}),e.jsx(Zo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:a,originalTurn:l})]})]}),e.jsxs(Ko,{horizontalScrollContainerRef:I,rootElementRef:A,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:D,children:[e.jsxs(Qo,{children:[e.jsx(Cn,{messages:M,isUserTurn:H,avatarClassName:p}),e.jsx(Jo,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(L,{...ea.responseNumber,values:{responseIndex:2}})})]}),y&&D?e.jsx(Xo,{}):e.jsxs(e.Fragment,{children:[W!=null&&!H&&e.jsx(Vo,{clientThreadId:d.clientThreadId,messages:M,isParagen:!0}),e.jsx(_n,{...d,groupedMessagesToRender:_,allGroupedMessages:_,isEditing:!1,isUserTurn:H,isCompletionRequestInProgress:G,hasActiveRequest:r,handleEnterEdit:js,handleExitEdit:js,shouldGrowContainer:!1}),e.jsx(Zo,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function Ko({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:a,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=ro(),c=ze(),{scrollX:d}=Xi({layoutEffect:!1,container:t,target:s}),h=Ld(),u=Fd(),m=i.useRef(null),g=i.useRef(null),v=i.useRef(null),[M,p]=i.useState(!1),[j,b]=i.useState(!1),[_,C]=i.useState(!1),[w,x]=i.useState(0);i.useEffect(()=>{if(!l)return;const A=new IntersectionObserver(R=>{for(const D of R)D.target===m.current?p(D.isIntersecting):D.target===v.current?C(D.isIntersecting):D.target===g.current&&b(D.isIntersecting)},{root:h?.current,rootMargin:c?`0px 0px -${w}px 0px`:void 0});return m.current&&g.current&&v.current&&(A.observe(m.current),A.observe(g.current),A.observe(v.current)),()=>{A.disconnect()}},[w,l,c,h]);const k=!_&&(j||M),G=Ji(d,A=>k?-1*A:0),E=Co(0);i.useEffect(()=>{if(!l)return;const A=new ResizeObserver(R=>{_s(R.length===1,"entryList.length === 1");const D=R[0];_s(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),E.set(D.contentBoxSize[0].inlineSize)});return s.current&&A.observe(s.current),()=>{A.disconnect()}},[l,E,s]);const H=Co(0);i.useEffect(()=>{if(!l)return;const A=new ResizeObserver(R=>{_s(R.length===1,"entryList.length === 1");const D=R[0];_s(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),H.set(D.contentBoxSize[0].blockSize+16),x(D.contentBoxSize[0].blockSize)});return u.current&&A.observe(u.current),()=>{A.disconnect()}},[l,H,u]);const I=e.jsx(Pt,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(L,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),f=r;return e.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:v}),a,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:f?null:e.jsx(se.div,{style:{translateX:G,width:E,bottom:H},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:k,"z-20 flex w-full justify-center":!0}),children:I})}):n?null:I]})}function Xo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(rt,{className:"h-4 w-[75%]"}),e.jsx(rt,{className:"h-4 w-[50%]"}),e.jsx(rt,{className:"h-4 w-[80%]"}),e.jsx(rt,{className:"h-4 w-[55%]"}),e.jsx(rt,{className:"h-4 w-[66%]"}),e.jsx(rt,{className:"h-4 w-[64%]"}),e.jsx(rt,{className:"h-4 w-[48%]"})]})}function ro(){const{layer:t}=et("3119715334");return t.get("should-enable-hojicha",!1)}const Jo=fe.div`text-sm text-token-text-secondary font-semibold`,Qo=fe.div`flex gap-4 items-center mb-1`,rt=fe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Zo({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:a}){const n=qn();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||o==null)return null;let r=o===a?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:m,model_definition_slug:g,model_definition_virtual_model_id:v,alternative_model_selection_rule:M,augmented_paragen_prompt_group_id:p,augmented_paragen_prompt_id:j,augmented_paragen_prompt:b}=c;m&&(r+=`
Model ID: ${m}`),g&&(r+=`
Model Slug: ${g}`),v&&(r+=`
Virtual Model ID: ${v}`),M&&(r+=`
Alternative Model Rule: ${M}`),p&&(r+=`
Prompt Group ID: ${p}`),j&&(r+=`
Prompt ID: ${j}`),b&&(r+=`
Prompt: ${b}`)}r+=`
Message ID: ${l.message.id}`;const h=J.getTree(t).getParentPromptNode(o.variantIds[0]),u=h.metadata?.variantsInStreamInfo==null&&h.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${h.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:Qe(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Rs({shouldUseNewParagenEndpoint:t,params:s}){t?await At.submitParagenSelectionV2(s):await At.submitMessageComparisonFeedback(s)}function og(){const{value:t}=Pe("3894844102");return t}const ea=$e({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function ag(t){return t.author.role===Ne.Tool&&t.author.name==="file_search"&&t.content.content_type===Ls.TetherBrowsingDisplay}function rg({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:o,responseComplete:a=!1}){const n=qe(s,c=>Hn.getTurnContentReferences(c,o)),r=qe(s,c=>c?.conversationTurns[o]?.messages??[]),l=i.useMemo(()=>{const c=new Set,d=[];function h(m){!m||c.has(m)||(c.add(m),d.push(m))}if(n.forEach(m=>{m.type==="file"?h(m.cloud_doc_url??m.extra?.cloud_doc_url):m.type==="file_navlist"&&m.items.forEach(g=>{h(g.cloud_doc_url)})}),a){for(const m of r)if(ag(m.message)){const g=Hd(m.message.content.result),v=m.message.metadata?.cloud_doc_urls??[],M=g.chunks;for(let p=0;p<M.length;p++){const j=M[p];if(!j.documentId)continue;if(p<v.length){h(v[p]);continue}const b=j.documentId.endsWith("--google")?j.documentId.split("--")[1]:void 0,_=j.metadata.cloud_doc_url??(b?`https://drive.google.com/file/d/${b}`:void 0);h(_?.toString())}break}}const u=[];for(let m=0;m<d.length;m++){const g=d[m],v=Od(g);if(v&&u.push(v.Icon),u.length>=3)break}return u},[r,n,a]);return e.jsxs(e.Fragment,{children:[e.jsx(se.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:P("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:t,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(L,{id:"/48IOP",defaultMessage:"Sources"})}),l.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:l.reverse().map((c,d)=>e.jsx(se.div,{className:P("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(c,{className:"icon-md"})},d))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const ta=[1,2,3,4,10,20,30],ig=.5;function lg({clientThreadId:t,conversationLeafId:s}){const o=nr(or.isBusinessWorkspace),a=i.useRef(!1),n=os(t),r=Vs(t),{isUnauthenticated:l}=He(),c=i.useMemo(()=>{if(!n)return-1;const H=sr(n);return H()>ig?-1:ta[Math.floor(H()*ta.length)]},[n]),d=Pi(t,s),h=d[d.length-1],u=i.useMemo(()=>Bs.getRequestIdFromConversationTurn(h),[h]),m=lt(u),[g,v]=i.useState(null),[M,p]=i.useState(!1),[j,b]=i.useState(!1),[_,C]=i.useState(!1),w=H=>{const I=Qe(d)?.messages[0]?.message.id;v(H),G(I,H)},x=d.filter(H=>H.role===Ne.Assistant).length,k=h?.role===Ne.Assistant,G=i.useMemo(()=>$a((H,I)=>{n&&H&&At.submitConversationRating({conversation_id:n,message_id:H,rating:I,shown_at_assistant_turn:c}),K.logEvent(X.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:c,conversationId:n}),p(!0),setTimeout(()=>{b(!0)},1500)},2e3),[n,c]),E=x!==c||m||!k||!!o||r?.kind!==Ve.PrimaryAssistant||_||l;return i.useEffect(()=>{!E&&!a.current&&(K.logEvent(X.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),a.current=!0)},[E]),_||E?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(as,{children:M&&!j&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(sa,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(L,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!M&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(sa,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(L,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(hn,{$selected:g==="thumbsUp",onClick:()=>w("thumbsUp"),children:e.jsx(ar,{className:"icon-md"})}),e.jsx(hn,{$selected:g==="thumbsDown",onClick:()=>w("thumbsDown"),children:e.jsx(rr,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(hn,{className:"p-3",$selected:!1,onClick:()=>C(!0),children:e.jsx(Di,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const hn=fe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,sa=fe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,cg=Oe(()=>Ue(()=>import("./dhynomcx6cp3cbvl.js"),__vite__mapDeps([40,1,3,4,2,5,41])));function dg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:o,messageForRating:a,allGroupedMessages:n,currentModelId:r}){let l=null;const c=qs(g=>{const v=Hn.getCacheAwareConversationTurns(xa(t,g),s);let M=0;for(let p=v.length-1;p>=0;p--){const j=v[p];if(j.messages.some(b=>b.message.metadata?.is_indepth_feedback))return!0;if(j.messages.some(b=>b.message.author.role===Ne.Assistant)&&M++,M>=3)break}return!1}),d=os(t),h=$n(g=>g.voiceFeedbackThread),u=d===h,{voiceName:m}=Ud();return c?null:(u&&d?(Bi.feedbackShown.success({voice:m}),l=e.jsx("div",{className:"text-center",children:e.jsx(zd,{serverThreadId:d})})):a.rating&&o?l=e.jsx(cg,{clientThreadId:t,conversationMessage:a,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(lg,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const ug=Oe(()=>Ue(()=>import("./l9v5qdgerk1gihp8.js"),__vite__mapDeps([42,1,3,4,43,44,2,5,45,46])).then(t=>t.VoicePlayButton)),mg=Oe(()=>Ue(()=>import("./euzs4rpetzyhiwmq.js"),__vite__mapDeps([47,1,2,3,4,5,48])).then(t=>t.AutomationSourceHeader)),na=80,hg=16,oa={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function gg(t){const{turnIndex:s,conversationLeafId:o,isFinalTurn:a,clientThreadId:n,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:d,showAvatar:h=!0,scrollToMessageId:u,dateHeaderType:m}=t,g=Ce(),v=Vn(),M=!!v&&Li(v),p=Dn(),j=nr(or.isBusinessWorkspace),b=ca(),{value:_}=Pe("2848981774"),C=J.getServerThreadId(n),w=Mt(xn(n,s,o)),{messages:x,variantIds:k,variantsInStreamInfo:G}=w,E=Us(x),H=Gd();let I=x[x.length-1];for(const O of E){const ce=am(O);if(ce.some(ke=>H.has(ke.message.id))){I=ce[ce.length-1];break}}const f=x.slice(0,x.indexOf(I)+1),A=Ds(),[R,D]=i.useState(!1),[W,y]=i.useState(!1),z=k.findIndex(O=>f.some(ce=>ce.nodeId===O)),S=w.role===Ne.User,F=ut(),Z=Ae(n),$=mt(w.gizmoId??Z)?.data,q=Xn(c),re=Wd(c),me=ze(),ee=Vs(n,$?.gizmo.id),he=ua(n)===ma.STREAMING,De=!1,{value:ie}=In("2291672486"),_e=f.some(O=>O.message.content.content_type===Ls.MultimodalText),{layer:ve}=et("1547743984"),je=C&&A&&ve.get("show_share_button_inline",!1),{isUnauthenticated:Ee}=He(),[Be,Ge]=i.useState(!1),[Ye,ne]=i.useState(!1),B=w.messages.map(O=>O.message.id),N=i.useRef(null),U=x[x.length-1],te=U.rating,le=(u?.length??0)>2&&u!=="finalAgentTurn"&&a&&_&&me,oe=()=>{f.length===1&&(K.logEvent(X.editPrompt,{id:f[0].message.id,threadId:J.getServerThreadId(n)}),ue.logEvent("chatgpt_edit_prompt"),D(!0))},Se=i.useCallback(()=>{D(!1)},[]),ae=i.useCallback(O=>{Vd(n,s,b,O)},[n,s,b]),Te=O=>{l({nodeId:U.nodeId,messageId:U.message.id,rating:O}),K.logEvent(O==="thumbsDown"?X.messageFeedbackThumbsDownClicked:X.messageFeedbackThumbsUpClicked,{id:U.message.id,threadId:J.getServerThreadId(n),model:c,rating:O}),y(!0)},[Y]=i.useState(()=>Date.now()),be=i.useMemo(()=>Bs.getRequestIdFromConversationTurn(w),[w]),Le=ha({clientThreadId:n,conversationLeafId:o}),ge=lt(be)&&!Le,ht=Bn(),Dt=Us(f),pe=i.useRef(!1);qd(n),i.useEffect(()=>{if(pe.current||u===void 0||!_||!me||!N.current){u==="finalAgentTurn"&&a&&pe.current&&J.updateScrollToMessageId(n,void 0);return}(B.includes(u)||u==="finalAgentTurn"&&a)&&(pe.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(N.current)if(u==="finalAgentTurn"&&a)N.current.scrollIntoView({behavior:"instant",block:"end"}),J.updateScrollToMessageId(n,void 0);else{const O=N.current.offsetHeight;let ce;O>na?ce=na-O:ce=0,N.current.style.scrollMarginTop=`calc(${ce}px + ${hg}px + var(--thread-leading-height))`,N.current.scrollIntoView({behavior:"smooth"})}})}))},[u,N.current]);const Xe=Hn.getCanvasToOpenId(xa(n));i.useEffect(()=>{Xe&&($d(Xe),J.setCanvasToOpenId(n,void 0))},[Xe,n]);const{showDebugConversationTurns:gt}=qn(),Bt=ga(n),cs=Qa(n),pt=Yd({clientThreadId:n,conversationMode:ee}),tt=dt(n),Lt=i.useCallback(({requestedModelId:O,systemMessage:ce,juice:ke,extraStreamParams:ot})=>{const nn=new Zt;pt({id:U.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:nn,requestedModelId:O,systemMessage:ce,juice:ke,extraStreamParams:ot})},[U,pt]),Re=De,Ft=!p&&!Bt&&!F&&!S,ds=Kd(),ft=I.message.author.role===Ne.Assistant?I.message:null;Xd({isCompletionRequestInProgress:ge,isUserTurn:S,message:ft});const Ht=qe(n,O=>O?.tree!=null&&k.some(ce=>{const ke=O.tree.getLeafFromNode(ce);return O.tree.getHasErrorFromNode(ke.id)})),{isOpen:Ot}=Jd(),Ut=Aa(),Ke=Qd(ee),zt=!ds&&!Ke&&Ft&&a&&G?.num_variants_in_stream===2&&!U.inlineComparisonRating&&!Ht,us=Zd(w),Fe=zt,ms=zt&&!us,xt=!S&&!p&&!Bt&&!Ke&&!he&&!ge&&!Ot,Gt=xt&&(!j||Re||re||M)&&!Ke&&!Ee&&!F,st=!p&&!((ge||he)&&a)&&k.length>1&&!R&&!Fe;let Wt=!1;if(S&&f.length===1){const{shouldHideContent:O}=eu(f[0]);O&&(Wt=!0)}const hs=S&&!Ke&&!p&&!_e&&f.length===1&&!Wt&&!R&&!Ee,Vt=O=>{r(k[O]),K.logEvent(X.changeNode,{intent:"toggle_between"})},Qs=tu(w,f,gt),{toggleThreadSidebar:qt}=Fi(),vt=i.useCallback(()=>{qt({type:"retrievalResults",clientThreadId:n,turnIndex:s})},[qt,n,s]),{value:ye}=Pe("2912660649"),gs=i.useMemo(()=>ye&&!Z&&!S&&su(f)&&f.some(O=>{const ce=!!O.message.metadata?.content_references?.some(ot=>ot.type==="file"||ot.type==="file_navlist"),ke=q&&O.message.content.content_type===Ls.TetherBrowsingDisplay&&O.message.author.role===Ne.Tool&&O.message.author.name==="file_search"&&O.message.content.result.length>0&&O.message.content.result.trim()!=="Visible: 0% - 100%";return ce||ke}),[ye,q,S,f,Z]);if(!Qs&&!Fe)return le?e.jsx("div",{style:oa}):null;const St=f.some(({message:O})=>Hi.getAssetPointers(O).length>0),Zs=!St&&a&&cs&&!ie?e.jsx(Ts,{onClick:()=>{ue.logEvent("chatgpt_regenerate_try_again_button_clicked",c,{requestedModelId:c,...Ze({clientThreadId:n,turnIndex:s})});const O=new Zt;pt({id:tt,eventMetadata:{eventSource:"mouse"},turnTracker:O}),Fs()},icon:Qn,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,ps="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",fs=!St&&ie?e.jsx(eg,{className:ps,clientThreadId:n,message:U,onModelSelect:Lt,onDropdownChange:Ge,canRegenerateResponse:cs}):null,bt=!S&&!Wt&&(!a||!ge)?e.jsx(gu,{onClick:ae}):null,tn=!S&&(!a||!ge)&&(U.disclaimers??[]).length===0&&U.nodeId?e.jsx(ug,{conversationId:n,message:U,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,sn=!S&&U&&(!a||!ge)?e.jsx(pu,{message:U,isFinalTurn:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,xs=!1,vs=Gt&&!ge?e.jsxs("div",{className:"flex",children:[te!=="thumbsDown"&&e.jsx(Ts,{onClick:()=>Te("thumbsUp"),disabled:te==="thumbsUp",icon:te==="thumbsUp"?nu:ar,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${U.nodeId}`),te!=="thumbsUp"&&e.jsx(Ts,{onClick:()=>Te("thumbsDown"),disabled:te==="thumbsDown",icon:te==="thumbsDown"?ou:rr,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${U.nodeId}`)]}):null,nt=je&&e.jsx(Ts,{onClick:()=>{Os.openSharingModal(C)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:au}),yt=!ie&&e.jsx(Xh,{className:ps,clientThreadId:n,message:U,onModelSelect:Lt,onDropdownChange:Ge});function $t(O){return me?O:e.jsx(Kn,{clientThreadId:n,isStaticSharedThread:p,withVerticalPadding:!0,withHorizontalPadding:!Fe,children:O})}function wt(O){return me?O:e.jsx(es,{children:O})}return e.jsxs(e.Fragment,{children:[e.jsx(ru,{dateHeaderType:m,turn:w}),e.jsxs("article",{className:P("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",u==="finalAgentTurn"&&_&&me?"opacity-0":""),style:le?oa:void 0,ref:N,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":a,onMouseEnter:()=>ne(!0),onMouseLeave:()=>ne(!1),children:[e.jsx(iu,{role:w.role}),$t(e.jsx(e.Fragment,{children:Fe?e.jsx(tg,{isFeedbackEnabled:Gt,variantIds:k,variantsInStreamInfo:G,conversationTurnMountTime:Y,stubSideBySideFeedback:ms,...t}):wt(e.jsxs(e.Fragment,{children:[!S&&h&&e.jsx(fg,{children:e.jsx(Cn,{messages:f,isUserTurn:S,avatarClassName:d,gizmo:$})}),e.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!S&&lu),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!S&&!p&&e.jsx(cu,{messages:f,clientThreadId:n,gizmoId:$?.gizmo.id}),Ut&&!S&&e.jsx(mg,{clientThreadId:n,messages:f}),e.jsx(_n,{groupedMessagesToRender:Dt,allGroupedMessages:E,...t,isEditing:R,isUserTurn:S,isCompletionRequestInProgress:ge,isFeedbackEnabled:Gt,isFinalTurn:a,hasActiveRequest:ht,showEditButton:hs,handleEnterEdit:oe,handleExitEdit:Se}),q&&!ye&&e.jsx("div",{className:"mb-4",children:e.jsx(du,{messages:f})}),gs&&e.jsx(rg,{handleShowRetrievalResults:vt,clientThreadId:n,turnIndex:s,responseComplete:!(ge||he)}),(xt||st)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",S?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(uu,{alwaysShow:a,showInline:a||st,isHovered:Ye||Be,pagination:st&&e.jsx(mu,{showInline:a||st,currentPage:z,onChangeIndex:Vt,length:k.length,className:P("self-center",k.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[tn,bt,Zs,vs,xs,sn,yt,nt,fs]})})}),xt&&!ge?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(hu,{message:U,isFinalTurn:a})}):null,a&&!ge&&e.jsx(dg,{canShowInlineMessageFeedback:W,clientThreadId:n,conversationLeafId:o,messageForRating:U,allGroupedMessages:E,currentModelId:c})]})]})})})]}))}))]})]})}const pg=wa.memo(gg),fg=fe.div`flex-shrink-0 flex flex-col relative items-end`;function xg({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:o,onRequestCompletion:a,clientThreadId:n,conversationLeafId:r,hideHeader:l}){const c=we(),d=Pn(),h=fu(),[u]=xu(),m=vu(),[g]=Su(),v=Vs(n),M=Gs(),p=rs(n),b=J.getConversationOrigin(n)===Oi.APPLE,_=c.store.useContentAreaDimensions(Rt.Header,F=>F?.height?F.height:void 0),C=c.store.useIsHeaderContentAreaPopulated(),w=va(n),{isArchived:x}=w,k=bu(p.id),G=v?.kind===Ve.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":k,E=Sa(n,r),H=yu(),[I,f]=i.useState(0),[A,R]=i.useState(!1);i.useEffect(()=>{d&&(I===0?f(E):!A&&E>I&&(R(!0),ue.logEvent("chatgpt_continue_conversation_first_message_sent"),K.logEvent(X.continueConversationFirstMessageSent)))},[E,I,A,d]),i.useEffect(()=>{d&&(ue.logEvent("chatgpt_continue_conversation_page_loaded"),K.logEvent(X.continueConversationPageLoaded),ue.logEvent("chatgpt_conversation_share_page_loaded"),K.logEvent(X.sharedConversationPageLoaded))},[d]);const D=i.useCallback(()=>{h({behavior:"smooth"})},[h]),W=wu(n),y=H&&!x,z=ju(n,r),S=(F,Z,$)=>[...new Array(Z-F).keys()].map(q=>{const re=q+F;return e.jsx(pg,{isFinalTurn:$(re),turnIndex:re,clientThreadId:n,conversationLeafId:r,onChangeItemInView:t,onChangeRating:o,onRequestMoreCompletions:s,onRequestCompletion:a,currentModelId:p.id,avatarClassName:G,scrollToBottom:D,dateHeaderType:z(re)},re)});return e.jsxs("div",{onCopy:W,className:P("flex flex-col text-sm",y&&"pb-[120px]",_||y?null:"md:pb-9"),style:{paddingBottom:y?void 0:_},children:[!l&&M?.data&&e.jsx(jr,{clientThreadId:n}),d&&e.jsxs(e.Fragment,{children:[e.jsx(es,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(L,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),E-I===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Os.openModal(Mu.ReportConversation),ue.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),K.logEvent(X.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(L,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),S(0,I,F=>F===I-1),e.jsx(es,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Cu,{className:"icon-xs mr-2"}),e.jsx(L,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),S(I,E,F=>F===E-1)]}),!d&&S(0,E,F=>F===E-1),b&&u&&!g&&e.jsx(aa,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ue.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(_u,{className:"icon-md text-token-text-primary"})}),!u&&e.jsx(aa,{className:P(_?null:"bottom-5",y?C?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:H?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":_},onClick:()=>{ue.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(Tu,{className:"icon-md text-token-text-primary"})})]})}const aa=fe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,vg=60,Sg=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const a=i.useRef(null);return e.jsx("div",{className:"h-full",ref:a,children:e.jsx(Ui,{children:e.jsx(om,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>bg(a,o)?0:1/0,children:t})})})},bg=(t,s)=>{const o=yg(t.current);if(o==null)return!1;const a=o>s,n=o<s-vg;return!a&&!n};function yg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,a=t.getBoundingClientRect().top;return o-a}const wg=Oe(()=>Ue(()=>import("./d6quty219r41nxu4.js"),__vite__mapDeps([49,3,1,4,2,5,50,51,52,53,54,45,55])).then(t=>t.OpenDebugSidebarButton)),jg=Oe(()=>Ue(()=>import("./iznswzwmsq1qveib.js"),__vite__mapDeps([56,1,2,3,4,5]))),ra=$e({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Mg({clientThreadId:t}){const s=ya(),o=os(t),a=async()=>{o&&(await At.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),qs.setState(n=>{const r=n.threads[o];r!=null&&(r.initialThreadData.isArchived=!1)}),qu(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(L,{...ra.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Pt,{disabled:!o,onClick:a,icon:Wu,children:e.jsx(L,{...ra.unarchiveButton})})})]})}const Bg=function({clientThreadId:t,onCompletionFinished:s,onCreate:o,preRequestCompletion:a,hideHeader:n,hideMessages:r,hideFooter:l,hideToolsOverlay:c,messagesVerticalAlign:d="top",prependThreadChildren:h,renderEmptyState:u,prefetchSearch:m}){const g=da(),v=Ys(t),M=Ws(t),p=dt(t),b=va(t).isArchived;zi(t),i.useEffect(()=>{M||(_t(t)?fn.addTiming("chatgpt.web.chatPage.renderNewConversation"):fn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,M]);const _=pa(t,p),C=Sa(t,p),{setTargetedContent:w}=Wa(),x=g?.includes(Gi),k=ku(),G=C>=2;za(G);const E=_t(t)&&!G&&Ps(v),H=_t(t)&&!_&&(Ps(v)||v?.kind===Ve.GizmoTest),f=Ga().id,A=Wi(t),R=A??f,D=!!A,W=Xn(R),z=Ua()[R],S=Nu(t,v),F=Oa();Au(C,t,p),i.useEffect(()=>{F||w(void 0)},[t,w,F,p]);const{caModal:Z,onRequestCompletion:$,onChangeItemInView:q,onChangeRating:re,onRequestMoreCompletions:me}=Eu({clientThreadId:t,currentModelId:R,defaultModelId:f,onCompletionFinished:s,onThreadCreated:o,preRequestCompletion:a}),{isUnauthenticated:ee,isLoading:xe}=He(),he=Ru({clientThreadId:t,currentLeafId:p,handleRequestCompletion:$,prefetchSearchPromise:m}),De=Te=>e.jsx(Sg,{scrollAnchorTopOffset:n?0:Vu,children:d==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),Te]}):Te});i.useEffect(()=>{document.title=S??"ChatGPT"},[S]);const ie=Ae(t),_e=ut(),ve=Vi(),je=H&&!ve&&!u&&!ie&&!W&&!_e,Ee=je&&!xe&&ee,Be=je&&!xe&&!ee,Ge=ph(Ee),Ye=xh(Be),ne=Ee&&Ge||Be&&Ye,B=Pn(),N=Iu(),{reset:U,streamingContext:te,StreamingProvider:le}=Pu();i.useEffect(()=>{N&&(te.setOnResetContext=()=>{U()})},[N,U,te]);const oe=i.useRef(null),Se=i.useRef(null),ae=i.useMemo(()=>({threadContentScrollContainerElementRef:oe,footerRootContainerElementRef:Se}),[]);return e.jsx(Du,{clientThreadId:t,currentLeafId:p,children:e.jsxs(le,{value:te,children:[x&&e.jsx(jg,{}),e.jsx(Bu,{children:S!=null&&e.jsx("title",{children:S})}),e.jsx(qi.Provider,{value:$,children:e.jsxs(Lu,{children:[e.jsxs(Fu,{clientThreadId:t,currentModelConfig:z,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(Hu,{value:ae,children:e.jsx(Cg,{ref:oe,children:!M&&!he?H?u??e.jsx(qh,{clientThreadId:t,currentModelId:R,isModelLoaded:D,onRequestCompletion:$,enableV2Homepage:ne,v2HomepageDisclaimer:ne&&e.jsx(Do,{clientThreadId:t})}):G?De(e.jsxs(e.Fragment,{children:[h,e.jsx(xg,{onChangeItemInView:q,onRequestMoreCompletions:me,onChangeRating:re,onRequestCompletion:$,clientThreadId:t,conversationLeafId:p,hideHeader:n},t)]})):null:null})}),e.jsx(_g,{ref:Se,children:b?e.jsx(Mg,{clientThreadId:t}):e.jsxs("div",{children:[!ne&&e.jsx(uh,{clientThreadId:t,isNewThread:E,showPromptStarters:E||!_,currentModelId:R,onRequestCompletion:$}),!l&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Ps(v)&&!ne&&e.jsx("div",{className:"min-h-4",children:e.jsx(Do,{clientThreadId:t})})})]})})]}),!c&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[k?e.jsxs(e.Fragment,{children:[e.jsx(wg,{}),!1]}):null,e.jsx(Ou,{})]}),Z,e.jsx(Uu,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:B}),e.jsx(zu,{}),e.jsx(Gu,{conversationId:t,currentModelId:R,isActiveWindow:!ve})]})})]})})},Cg=fe.div`grow flex-1 overflow-hidden @container/thread`,_g=fe.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{pg as C,qh as E,Nn as G,pr as P,vh as S,Hh as T,Sg as W,Bg as a,jr as b,uh as c,Uh as d,Dg as e,Sr as u};
//# sourceMappingURL=ngpfizqqb9onsju2.js.map
